"use strict";(self["webpackChunkArogs"]=self["webpackChunkArogs"]||[]).push([[142],{54183:function(t,e,s){s.r(e),s.d(e,{default:function(){return g}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"service-box pb-150"},["/customerService2"==t.$route.path?e("van-nav-bar",{attrs:{title:t.$t("在线客服"),"left-arrow":"",fixed:""},on:{"click-left":t.onClickLeft}}):t._e(),e("div",{staticStyle:{width:"100%",height:"46px"}}),e("div",{staticClass:"content"},[e("div",{staticClass:"flex flex-col px-15 box-border"},[e("div",{staticClass:"w-full py-10 text-grey text-center pt-100",staticStyle:{"font-size":"14px"},style:{visibility:t.finished?"hidden":"visiable"},on:{click:t.onMore}},[t._v(" "+t._s(t.$t("历史消息"))+" ")]),e("ul",{staticClass:"flex flex-col pt-20"},t._l(t.list,(function(i,a){return e("li",{key:i.id,staticClass:"flex flex-col mt-20"},[t.showTime(a)?e("p",{staticClass:"font-26 text-center py-20 text-grey",staticStyle:{"font-size":"14px"}},[t._v(" "+t._s(t.$formatZoneDate(i.createtime)&&t.$formatZoneDate(i.createtime.split(" ")[0]))+" ")]):t._e(),e("div",{staticClass:"flex",class:"send"===i.send_receive?"justify-end":""},["receive"===i.send_receive?[e("img",{staticClass:"w-44 h-44 mr-10",attrs:{src:"FamilyShop"==t.itemname?s(57710)(`./${t.itemname}/sevice.png`):"TikTok"==t.itemname?s(15870)(`./${t.itemname}/logo.png`):s(37230)(`./${t.itemname}/logo.svg`)}}),e("div",{staticClass:"responser bg-grey px-15 py-12 font-30 rounded-lg",staticStyle:{"font-size":"14px"}},["text"===i.type?e("p",{staticClass:"break-word",staticStyle:{"max-width":"230px"}},[t._v(" "+t._s(i.content)+" ")]):e("img",{staticClass:"w-200 h-200",attrs:{src:i.content},on:{click:function(e){return t.onPreview(i.content)}}})])]:e("div",{staticClass:"border-solid py-12 px-15 rounded-lg flex flex-col",staticStyle:{"font-size":"14px"}},["img"===i.type?e("img",{staticClass:"w-200 h-200",attrs:{src:`${i.content}`},on:{click:function(e){return t.onPreview(i.content)}}}):e("p",{staticClass:"break-word",staticStyle:{"max-width":"230px"}},[t._v(" "+t._s(i.content)+" ")])]),"send"===i.send_receive?e("img",{staticClass:"mr-10",staticStyle:{width:"44px",height:"44px","margin-left":"10px"},attrs:{src:t.userAvatar}}):t._e()],2)])})),0)])]),e("div",{staticClass:"bottom flex justify-between h-49 items-center w-full fixed bottom-0 border-t-grey px-10 box-border bg-white"},[e("van-uploader",{attrs:{"after-read":t.afterRead}},[e("img",{staticClass:"w-24 h-24",attrs:{src:s(62226)}})]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],staticClass:"flex-1 mx-20 h-full border-none",staticStyle:{"font-size":"14px"},attrs:{type:"text",placeholder:t.$t("请输入您的消息...")},domProps:{value:t.value},on:{input:function(e){e.target.composing||(t.value=e.target.value)}}}),e("div",{staticClass:"fasong",on:{click:function(e){return t.send("text",t.value)}}},[t._v(t._s(t.$t("发送")))])],1)],1)},a=[],n=(s(54735),s(49990)),l=(s(42511),s(29538)),r=s(66710),o=s(63822),c=s(15941),h={name:"CustomerService",components:{[l.Z.name]:l.Z},data(){return{list:[],value:"",lastMsgId:"",interval:null,unread:0,finished:!1,androidAttrs:null,token_url:"",userAvatar:"",count:"1"}},computed:{...(0,o.Se)({activeLang:"language"})},created(){this.count=localStorage.getItem("avater"),this.userAvatar=s(62829)(`./${this.count}.png`),this.$route.query.token?this.token_url=this.$route.query.token:localStorage.getItem("token")&&(this.token_url=localStorage.getItem("token")),this.$route.query.lang&&("cn"==this.$route.query.lang?this.handleSetLang("zh-CN"):this.handleSetLang("en-US")),this.fetchList();const t=navigator.userAgent;this.androidAttrs=t.indexOf("Android")>-1||t.indexOf("Linux")>-1},methods:{...(0,o.OI)(["setLanguage"]),handleSetLang(t){this.$i18n.locale=t},onPreview(t){(0,n.Z)([t])},showTime(t){return 0===t||t!==this.list.length-1&&(this.list[t].createtime.split(" ")[0]!==this.list[t+1].createtime.split(" ")[1]&&void 0)},afterRead(t){this.$toast.loading({duration:0});var e=this;let s=new FormData;s.append("file",t.file),s.append("moduleName","123"),(0,r.wL)(s).then((t=>{e.$toast.clear(),c.log(t),e.send("img",t)})).catch((function(t){c.log(t),this.$toast.clear()}))},fetchList(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";(0,r.kN)({token:this.token_url,message_id:t}).then((e=>{if(null==e&&(e=[]),this.lastMsgId||(this.lastMsgId=e.length&&e[e.length-1]["id"]),e.length){if(t)this.lastMsgId=e[e.length-1]["id"],this.list=[...e.reverse(),...this.list];else{this.list=[...this.list,...e.reverse()];let t={};this.list=this.list.reduce((function(e,s){return t[s.id]||(t[s.id]=e.push(s)),e}),[])}e.length<10&&(this.finished=!0)}else this.list=[{id:"1",send_receive:"receive",content:this.$t("你好，欢迎来到我们的平台"),type:"text"}];t||(this.clearInterval(),this.interval=setInterval((()=>{this.fetchList()}),1e3))}))},onMore(){this.fetchList(this.lastMsgId)},clearInterval(){this.interval&&(clearInterval(this.interval),this.interval=null)},fetchUnread(){(0,r.Dr)().then((t=>{this.unread=t}))},onClickLeft(){this.$router.go(-1)},send(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e?(0,r.$d)(t,e,this.token_url).then((t=>{c.log(t),this.value="",this.fetchList()})):this.$toast(this.$t("请输入消息内容"))}},beforeDestroy(){this.clearInterval()}},d=h,u=s(1001),v=(0,u.Z)(d,i,a,!1,null,"612b33b5",null),g=v.exports}}]);