import{z as _,d as L,be as Y,D as A,l as O,aD as ee,r as F,k as b,S as p,ad as oe,e as r,J as M,aR as T,L as te,a9 as ae,m as se,aJ as ne,aK as ie,ac as ce,ag as q,aZ as le,bq as re,Y as Z,bo as me,a5 as z,Z as N,C as $,aU as ue,br as ve,I as de,bh as ge,ba as he,A as fe,K as we,bA as Pe,bB as xe}from"./index-7648d0ea.js";import{S as Ce,a as Ie}from"./index-4845ca64.js";import{I as Se}from"./index-d018effd.js";const B=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),E=_("image-preview")[1];var ye=L({props:{src:String,show:Boolean,active:Number,minZoom:Y(A),maxZoom:Y(A),rootWidth:Y(Number),rootHeight:Y(Number)},emits:["scale","close"],setup(o,{emit:c}){const e=O({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=ee(),i=F(),d=b(()=>{const{rootWidth:t,rootHeight:s}=o,n=s/t;return e.imageRatio>n}),R=b(()=>{const{scale:t,moveX:s,moveY:n,moving:v,zooming:I}=e,X={transitionDuration:I||v?"0s":".3s"};if(t!==1){const G=s/t,Q=n/t;X.transform=`scale(${t}, ${t}) translate(${G}px, ${Q}px)`}return X}),g=b(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s/e.imageRatio:t;return Math.max(0,(e.scale*n-t)/2)}return 0}),h=b(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s:t*e.imageRatio;return Math.max(0,(e.scale*n-s)/2)}return 0}),f=t=>{t=T(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,c("scale",{scale:t,index:o.active}))},y=()=>{f(1),e.moveX=0,e.moveY=0},D=()=>{const t=e.scale>1?1:2;f(t),e.moveX=0,e.moveY=0};let w,P,x,C,a,m,u;const U=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),w=s.length,P=e.moveX,x=e.moveY,u=Date.now(),e.moving=w===1&&e.scale!==1,e.zooming=w===2&&!n.value,e.zooming&&(C=e.scale,a=B(t.touches))},J=t=>{const{touches:s}=t;if(l.move(t),(e.moving||e.zooming)&&M(t,!0),e.moving){const{deltaX:n,deltaY:v}=l,I=n.value+P,X=v.value+x;e.moveX=T(I,-g.value,g.value),e.moveY=T(X,-h.value,h.value)}if(e.zooming&&s.length===2){const n=B(s),v=C*n/a;f(v)}},j=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=l,n=Date.now()-u,v=250,I=5;t.value<I&&s.value<I&&n<v&&(m?(clearTimeout(m),m=null,D()):m=setTimeout(()=>{c("close"),m=null},v))},k=t=>{let s=!1;(e.moving||e.zooming)&&(s=!0,e.moving&&P===e.moveX&&x===e.moveY&&(s=!1),t.touches.length||(e.zooming&&(e.moveX=T(e.moveX,-g.value,g.value),e.moveY=T(e.moveY,-h.value,h.value),e.zooming=!1),e.moving=!1,P=0,x=0,C=1,e.scale<1&&y(),e.scale>o.maxZoom&&(e.scale=+o.maxZoom))),M(t,s),j(),l.reset()},V=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;e.imageRatio=n/s};return p(()=>o.active,y),p(()=>o.show,t=>{t||y()}),oe("touchmove",J,{target:b(()=>{var t;return(t=i.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>r(te,{type:"spinner"},null)};return r(Ce,{ref:i,class:E("swipe-item"),onTouchstartPassive:U,onTouchend:k,onTouchcancel:k},{default:()=>[r(Se,{src:o.src,fit:"contain",class:E("image",{vertical:d.value}),style:R.value,onLoad:V},t)]})}}});const[be,S]=_("image-preview"),Te=["show","transition","overlayStyle","closeOnPopstate"],pe={show:Boolean,loop:Z,images:me(),minZoom:z(1/3),maxZoom:z(3),overlay:Z,closeable:Boolean,showIndex:Z,className:N,closeIcon:$("clear"),transition:String,beforeClose:Function,overlayClass:N,overlayStyle:Object,swipeDuration:z(300),startPosition:z(0),showIndicators:Boolean,closeOnPopstate:Z,closeIconPosition:$("top-right")};var K=L({name:be,props:pe,emits:["scale","close","closed","change","update:show"],setup(o,{emit:c,slots:e}){const l=F(),i=O({active:0,rootWidth:0,rootHeight:0}),d=()=>{if(l.value){const a=ue(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},R=a=>c("scale",a),g=a=>c("update:show",a),h=()=>{ge(o.beforeClose,{args:[i.active],done:()=>g(!1)})},f=a=>{a!==i.active&&(i.active=a,c("change",a))},y=()=>{if(o.showIndex)return r("div",{class:S("index")},[e.index?e.index({index:i.active}):`${i.active+1} / ${o.images.length}`])},D=()=>{if(e.cover)return r("div",{class:S("cover")},[e.cover()])},w=()=>r(Ie,{ref:l,lazyRender:!0,loop:o.loop,class:S("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:f},{default:()=>[o.images.map(a=>r(ye,{src:a,show:o.show,active:i.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:R,onClose:h},null))]}),P=()=>{if(o.closeable)return r(de,{role:"button",name:o.closeIcon,class:[S("close-icon",o.closeIconPosition),ve],onClick:h},null)},x=()=>c("closed"),C=(a,m)=>{var u;return(u=l.value)==null?void 0:u.swipeTo(a,m)};return ae({swipeTo:C}),se(d),p([ne,ie],d),p(()=>o.startPosition,a=>f(+a)),p(()=>o.show,a=>{const{images:m,startPosition:u}=o;a?(f(+u),ce(()=>{d(),C(+u,{immediate:!0})})):c("close",{index:i.active,url:m[i.active]})}),()=>r(re,q({class:[S(),o.className],overlayClass:[S("overlay"),o.overlayClass],onClosed:x,"onUpdate:show":g},le(o,Te)),{default:()=>[P(),w(),y(),D()]})}});let H;const Xe={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Ye(){({instance:H}=Pe({setup(){const{state:o,toggle:c}=xe(),e=()=>{o.images=[]};return()=>r(K,q(o,{onClosed:e,"onUpdate:show":c}),null)}}))}const W=(o,c=0)=>{if(!!he)return H||Ye(),o=Array.isArray(o)?{images:o,startPosition:c}:o,H.open(fe({},Xe,o)),H};W.Component=we(K);W.install=o=>{o.use(W.Component)};export{W as I};
