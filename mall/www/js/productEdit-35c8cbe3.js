import{z as me,D as ve,Z as q,d as pe,bK as fe,a8 as be,e as s,L as ge,K as he,_ as Te,h as Ce,k as B,g as _e,u as ke,ai as xe,j as ye,r as h,bF as M,m as Ve,S as H,l as Se,I as Pe,bq as $e,c as U,w as g,a as u,q as n,n as we,b as T,T as r,b1 as Ne,o as w,t as p,f as J,s as De,U as Fe,al as Ie,P as Be,Q as Me}from"./index-ddb6536b.js";import{B as Ue}from"./index-b0cd68f2.js";import"./index-2fdd0334.js";import{C as Ee}from"./index-013e7b20.js";import"./index-7b0a5398.js";import{F as Oe}from"./index-ce70249a.js";import{s as Re,b as Ye,d as ze}from"./product.api-7575602b.js";import{D as je}from"./index-32a89867.js";import{F as Ge}from"./index-72f87333.js";import{D as te}from"./function-call-a28ca42a.js";import"./use-id-f524f426.js";import"./index-b2676452.js";import"./stringify-3d6d9ce2.js";import"./___vite-browser-external_commonjs-proxy-25d2dffe.js";const[Le,A]=me("switch"),qe={size:ve,loading:Boolean,disabled:Boolean,modelValue:q,activeColor:String,inactiveColor:String,activeValue:{type:q,default:!0},inactiveValue:{type:q,default:!1}};var He=pe({name:Le,props:qe,emits:["change","update:modelValue"],setup(c,{emit:N,slots:k}){const V=()=>c.modelValue===c.activeValue,E=()=>{if(!c.disabled&&!c.loading){const l=V()?c.inactiveValue:c.activeValue;N("update:modelValue",l),N("change",l)}},O=()=>{if(c.loading){const l=V()?c.activeColor:c.inactiveColor;return s(ge,{class:A("loading"),color:l},null)}if(k.node)return k.node()};return fe(()=>c.modelValue),()=>{var l;const{size:R,loading:S,disabled:i,activeColor:D,inactiveColor:e}=c,P=V(),x={fontSize:be(R),backgroundColor:P?D:e};return s("div",{role:"switch",class:A({on:P,loading:S,disabled:i}),style:x,tabindex:i?void 0:0,"aria-checked":P,onClick:E},[s("div",{class:A("node")},[O()]),(l=k.background)==null?void 0:l.call(k)])}}});const Je=he(He);const oe=c=>(Be("data-v-47e02415"),c=c(),Me(),c),Ae={class:"editProduct"},Ke={class:"tip pt-2 pb-2 pl-4 pr-4"},Qe={class:"profit"},Ze={key:0,class:"flex pl-4 pr-4 input-item pt-3 pb-3"},We={class:"flex"},Xe={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},et={class:"flex"},tt={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},ot={class:"flex"},lt={class:"tip pt-2 pb-2 pl-4 pr-4"},at=oe(()=>u("span",null,"%",-1)),nt={class:"tips pt-2 pb-2 pl-4 pr-4"},it={class:"tip pt-2 pb-2 pl-4 pr-4"},st={class:"tip pt-2 pb-2 pl-4 pr-4"},ut={class:"tip pt-2 pb-2 pl-4 pr-4"},rt=oe(()=>u("span",null,"%",-1)),ct={style:{margin:"16px"},class:"pb-8"},dt={__name:"productEdit",setup(c){const N="tiktokMall",k=Ce(),V=B(()=>{}),E=B(()=>{}),O=_e(),{t:l}=ke(),R=xe(),S=ye(),i=h(JSON.parse(R.query.item)),D=h(new Date),e=h({sellingPrice:"",isShelf:0,recTime:0,isCombo:!1,startTime:M(),endTime:M(),discount:"",percent:"",profit:"",id:""}),P=()=>{te.confirm({title:l("product.21"),message:l("product.22"),confirmButtonText:l("sure"),cancelButtonText:l("cancel")}).then(()=>{ze({sellerGoodsId:e.value.id}).then(()=>{r(l("product.10")),S.go(-1)})}).catch(()=>{})},x=h(!1),$=h(!1),Y=h(!1),F=h(""),z=h(""),le=h(""),j=B(()=>{let t={};return k.userInfo.token?t={...k.userInfo}:S.push("/login"),t});Ve(()=>{ie()}),H(()=>e.value.percent,(t,o)=>{}),H(()=>e.value.isCombo,(t,o)=>{t&&(console.log("\u5F00\u5173\u6253\u5F00"),ae())}),H(()=>e.value.isShelf,(t,o)=>{console.log("\u5F00\u5173\u6253\u5F00",t),t/1===1&&ne()});const C=h(!1),ae=()=>{C.value=!0,I()},y=h(!1),ne=()=>{y.value=!0,I()},d=Se({min:"",max:""}),ie=()=>{console.log("productInfo.value",i.value),e.value.id=i.value.id,e.value.discountPrice=i.value.discountPrice?(i.value.discountPrice/1).toFixed(2):(i.value.sellingPrice/1).toFixed(2),e.value.sellingPrice=(i.value.sellingPrice/1).toFixed(2),e.value.isShelf=i.value.isShelf/1,e.value.isCombo=Boolean(i.value.isCombo/1),e.value.recTime=i.value.recTime/1,e.value.startTime=i.value.discountStartTime?i.value.discountStartTime.split(" ")[0]:i.value.discountStartTime,e.value.endTime=i.value.discountEndTime?i.value.discountEndTime.split(" ")[0]:i.value.discountEndTime,e.value.profit=(i.value.profitRatio*100).toFixed(2),e.value.discount=(i.value.discountRatio*100).toFixed(2),e.value.systemPrice=(i.value.systemPrice/1).toFixed(2),e.value.percent=(i.value.profitRatio/1*100).toFixed(2),d.min=Number(i.value.sysParaMin),d.max=Number(i.value.sysParaMax),Re().then(t=>{d.min=Number(t.sysParaMin),d.max=Number(t.sysParaMax)})},se=()=>{if([].includes(N))if(j.value.phoneverif&&j.value.emailverif)I();else{const t=j.value.phoneverif?"bindEmailTips":"\u8BF7\u7ED1\u5B9A\u624B\u673A\u53F7";te.confirm({title:l("dialogTips"),message:l(t),cancelButtonText:l("cancel"),confirmButtonText:l("gotoSet"),confirmButtonColor:"#1552F0",cancelButtonColor:"#999"}).then(()=>{Ie("/personalInfo")}).catch(()=>{console.log("cancel")})}else I()},I=()=>{const{startTime:t,endTime:o,discount:f}=e.value;if(t||o){const m=new Date(t.replace(/-/g,"/")+" 00:00:00").getTime(),b=new Date(o.replace(/-/g,"/")+" 00:00:00").getTime();if(!f){C.value=!1,y.value=!1,e.value.isCombo=!1,e.value.isShelf=!1,r(l("\u8BF7\u8BBE\u7F6E\u6298\u6263\u6BD4\u4F8B"));return}if(m>b){C.value=!1,y.value=!1,e.value.isCombo=!1,e.value.isShelf=!1,r(l("\u5F00\u59CB\u65F6\u95F4\u5E94\u5C0F\u4E8E\u7ED3\u675F\u65F6\u95F4"));return}}if(Number(f)&&(!t||!o)){C.value=!1,y.value=!1,e.value.isCombo=!1,e.value.isShelf=!1,r(l("\u8BF7\u6B63\u786E\u586B\u5199\u6D3B\u52A8\u5F00\u542F\u65F6\u95F4\u548C\u7ED3\u675F\u65F6\u95F4"));return}if(!W()){r.loading({forbidClick:!0,loadingType:"spinner",duration:0});let m={isShelf:e.value.isShelf?1:0,recTime:e.value.recTime?1:0,isCombo:e.value.isCombo?1:0,sellerGoodsId:i.value.id,startTime:e.value.startTime?e.value.startTime+" 00:00:00":"",endTime:e.value.endTime?e.value.endTime+" 00:00:00":"",discount:(e.value.discount/100).toFixed(2),percent:(e.value.percent/100).toFixed(2),profit:(e.value.percent/100).toFixed(2)};return Ye(m).then(b=>{C.value?C.value=!1:y.value?y.value=!1:(r(l("product.10")),S.push("/product"))}).catch(b=>{const v=b.msg;if(C.value=!1,y.value=!1,v.indexOf("\u672A\u8D2D\u4E70")>-1)r(l("\u60A8\u6682\u672A\u8D2D\u4E70\u76F4\u901A\u8F66\u5957\u9910\uFF0C\u8BF7\u8D2D\u4E70\u518D\u8BD5"));else if(v.indexOf("\u5DF2\u5230\u671F")>-1)r(l("\u60A8\u7684\u76F4\u901A\u8F66\u5DF2\u5230\u671F"));else if(v.indexOf("\u6700\u591A\u63A8\u5E7F")>-1){const _=v.split("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A");r(l("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A")+": "+_[1])}else if(v.indexOf("\u672A\u6FC0\u6D3B")>-1)r(l("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(v.indexOf("\u672A\u6FC0\u6D3B")>-1)r(l("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(v.indexOf("\u6700\u5C0F\u4E0B\u67B6")>-1)r(l("\u5C11\u4E8E\u5E97\u94FA\u8BBE\u7F6E\u6700\u5C0F\u4E0B\u67B6\u5546\u54C1\u6570"));else if(v.indexOf("\u9996\u6B21\u4E0A\u67B6")>-1){const _=typeof b.data=="string"?JSON.parse(b.data):b.data;r(l(v,{_$1:_._$1}))}else r(l(v));e.value.isCombo=!1})}},K=t=>{switch(t){case 1:x.value=!0;break;case 2:$.value=!0;break;case 3:Y.value=!0;break}},Q=t=>{switch(console.log(F.value),t){case 1:x.value=!1,e.value.startTime=M(F.value).format("YYYY-MM-DD");break;case 2:$.value=!1,e.value.endTime=M(z.value).format("YYYY-MM-DD");break;case 3:Y.value=!1,e.value.recTime=ue(le.value);break}},Z=t=>{switch(t){case 1:x.value=!1;break;case 2:$.value=!1;break;case 3:Y.value=!1;break}},ue=t=>{let o=t.getFullYear(),f=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,m=t.getDate()<10?"0"+t.getDate():t.getDate(),b=t.getHours()<10?"0"+t.getHours():t.getHours(),v=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),_=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return o+"-"+f+"-"+m+" "+b+":"+v+":"+_},re=B(()=>{let t=0;if(!isNaN(e.value.sellingPrice)&&!isNaN(e.value.discount)){const o=Number(e.value.systemPrice),f=Number((Number(e.value.discount)/100).toFixed(2)),m=Number(e.value.sellingPrice)*(1-f);t=Number(m-o)}return t.toFixed(2)}),G=()=>{const t=Number(e.value.systemPrice),o=Number((Number(e.value.percent)/100).toFixed(2));e.value.sellingPrice=Number((t+t*o).toFixed(2))},W=()=>{const t=Number(e.value.percent),o=Number(e.value.discount);let f=!1;if(!isNaN(t)){const m=/^\+?[1-9][0-9]*$/;if(!m.test(String(t)))return r(l("\u767E\u5206\u6BD4\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;if(o&&!m.test(String(o)))return r(l("\u6298\u6263\u6BD4\u4F8B\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;t>d.max&&(console.log("12"),e.value.percent=d.max,f=!0,G()),t<d.min&&(console.log("33"),e.value.percent=d.min,f=!0,G())}return f&&d.min&&d.max&&r(l("\u767E\u5206\u6BD4\u8BBE\u7F6E\u8303\u56F4\u4E3A")+`\uFF1A${d.min}% ~ ${d.max}%`),f},ce=()=>{const t=Number(e.value.sellingPrice),o=Number(e.value.systemPrice),f=Number(((t-o)/o*100).toFixed(2));e.value.percent=f};return(t,o)=>{const f=Ne,m=Oe,b=Ee,v=Je,_=Pe,L=je,X=$e,ee=Ue,de=Ge;return w(),U("div",Ae,[s(f,{fixed:""},{title:g(()=>[u("div",null,p(t.$t("\u7F16\u8F91\u5546\u54C1")),1)]),_:1}),u("div",{class:we(["edit-product-pop",{"is-ar":T(O)}])},[n(`        <div class="title">{{$t('\u7F16\u8F91\u5546\u54C1')}}</div>`),s(de,null,{default:g(()=>[u("div",Ke,p(t.$t("\u5F53\u524D\u552E\u4EF7")),1),s(b,{class:"input-field",inset:""},{default:g(()=>[n(` <van-field v-model="fromData.discountPrice" readonly :placeholder="$t('\u5F53\u524D\u552E\u4EF7')"> `),s(m,{modelValue:e.value.sellingPrice,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.sellingPrice=a),type:"number",placeholder:t.$t("\u5F53\u524D\u552E\u4EF7"),onInput:ce},{button:g(()=>[n(` <span class="profit">{{$t('\u5229\u6DA6')}} {{ (fromData.discountPrice - fromData.systemPrice).toFixed(2) }}</span> `),u("span",Qe,p(t.$t("\u5229\u6DA6"))+" "+p(T(re)),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),T(V)?n("v-if",!0):(w(),U("div",Ze,[u("div",null,p(t.$t("\u662F\u5426\u4E0A\u67B6")),1),u("div",We,[s(v,{modelValue:e.value.isShelf,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.isShelf=a),size:"25","inactive-color":"#fff","inactive-value":0,"active-value":1},null,8,["modelValue"])])])),u("div",Xe,[u("div",null,p(t.$t("\u662F\u5426\u63A8\u8350")),1),u("div",et,[s(v,{modelValue:e.value.recTime,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.recTime=a),"inactive-value":0,"active-value":1,size:"25","inactive-color":"#fff"},null,8,["modelValue"])])]),n(`          <div class="tip pt-2 pb-2 pl-4 pr-4" v-if="fromData.isRecommend">{{$t('\u63A8\u8350\u65F6\u95F4')}}</div>`),n('          <van-cell-group v-if="fromData.isRecommend" class="input-field" inset>'),n(`            <van-field @click-input="onClick(3)"  v-model="fromData.recTime" :placeholder="t('\u63A8\u8350\u65F6\u95F4')">`),n("            </van-field>"),n("          </van-cell-group>"),n('          <van-popup v-model:show="isRecommendShow"'),n("                     round"),n('                     position="bottom"'),n("          >"),n("            <van-datetime-picker"),n(`                :confirm-button-text="$t('\u786E\u5B9A')"`),n(`                :cancel-button-text="$t('\u53D6\u6D88')"`),n('                v-model="recommendTime"'),n('                type="datetime"'),n(`                :title="t('\u9009\u62E9\u5B8C\u6574\u65F6\u95F4')"`),n('                @confirm="onConfirm(3)"'),n('                @cancel="onCancel(3)"'),n("            />"),n("          </van-popup>"),u("div",tt,[u("div",null,p(t.$t("\u76F4\u901A\u8F66")),1),u("div",ot,[s(v,{loading:C.value,modelValue:e.value.isCombo,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.isCombo=a),size:"25","inactive-color":"#fff"},null,8,["loading","modelValue"])])]),u("div",lt,p(t.$t("\u767E\u5206\u6BD4")),1),s(b,{class:"input-field",inset:""},{default:g(()=>[s(m,{modelValue:e.value.percent,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.percent=a),type:"number",placeholder:T(l)("\u767E\u5206\u6BD4"),rules:[{required:!0,message:T(l)("\u8BF7\u586B\u5199\u767E\u5206\u6BD4"),max:d.max,min:d.min}],onInput:G,onBlur:W},{button:g(()=>[at]),_:1},8,["modelValue","placeholder","rules"])]),_:1}),u("div",nt,[J(p(t.$t("\u5C06\u9009\u4E2D\u7684\u5546\u54C1\u53D1\u5E03\u5230\u4F60\u7684\u5E97\u94FA\uFF0C\u5E76\u586B\u5199\u5546\u54C1\u5229\u6DA6\u6BD4\u4F8B\uFF0C\u63A8\u8350\u6BD4\u4F8B"))+": ",1),u("span",null,p(d.min)+"%-"+p(d.max)+"%",1)]),u("div",it,p(t.$t("\u6298\u6263\u5F00\u59CB\u65E5\u671F")),1),s(b,{class:"input-field",inset:"",style:{position:"relative"}},{default:g(()=>[e.value.startTime?(w(),U("div",{key:0,class:"time-clear",onClick:o[5]||(o[5]=a=>e.value.startTime="")},[s(_,{name:"cross"})])):n("v-if",!0),s(m,{onClickInput:o[6]||(o[6]=a=>K(1)),modelValue:e.value.startTime,"onUpdate:modelValue":o[7]||(o[7]=a=>e.value.startTime=a),placeholder:T(l)("\u6298\u6263\u5F00\u59CB\u65E5\u671F")},null,8,["modelValue","placeholder"]),s(X,{show:x.value,"onUpdate:show":o[11]||(o[11]=a=>x.value=a),round:"",position:"bottom"},{default:g(()=>[s(L,{"min-date":D.value,"confirm-button-text":t.$t("\u786E\u5B9A"),"cancel-button-text":t.$t("\u53D6\u6D88"),modelValue:F.value,"onUpdate:modelValue":o[8]||(o[8]=a=>F.value=a),type:"date",title:T(l)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:o[9]||(o[9]=a=>Q(1)),onCancel:o[10]||(o[10]=a=>Z(1))},null,8,["min-date","confirm-button-text","cancel-button-text","modelValue","title"])]),_:1},8,["show"])]),_:1}),u("div",st,p(t.$t("\u6298\u6263\u7ED3\u675F\u65E5\u671F")),1),s(b,{class:"input-field",inset:"",style:{position:"relative"}},{default:g(()=>[e.value.endTime?(w(),U("div",{key:0,class:"time-clear",onClick:o[12]||(o[12]=a=>e.value.endTime="")},[s(_,{name:"cross"})])):n("v-if",!0),s(m,{onClickInput:o[13]||(o[13]=a=>K(2)),modelValue:e.value.endTime,"onUpdate:modelValue":o[14]||(o[14]=a=>e.value.endTime=a),placeholder:T(l)("\u6298\u6263\u7ED3\u675F\u65E5\u671F")},null,8,["modelValue","placeholder"])]),_:1}),u("div",ut,p(t.$t("\u6298\u6263\u6BD4\u4F8B")),1),s(b,{class:"input-field",inset:""},{default:g(()=>[s(m,{modelValue:e.value.discount,"onUpdate:modelValue":o[15]||(o[15]=a=>e.value.discount=a),type:"number",placeholder:T(l)("\u6298\u6263\u6BD4\u4F8B")},{button:g(()=>[rt]),_:1},8,["modelValue","placeholder"])]),_:1}),s(X,{show:$.value,"onUpdate:show":o[19]||(o[19]=a=>$.value=a),round:"",position:"bottom"},{default:g(()=>[s(L,{"min-date":D.value,"cancel-button-text":t.$t("\u53D6\u6D88"),"confirm-button-text":t.$t("\u786E\u5B9A"),modelValue:z.value,"onUpdate:modelValue":o[16]||(o[16]=a=>z.value=a),type:"date",title:T(l)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:o[17]||(o[17]=a=>Q(2)),onCancel:o[18]||(o[18]=a=>Z(2))},null,8,["min-date","cancel-button-text","confirm-button-text","modelValue","title"])]),_:1},8,["show"]),u("div",ct,[s(ee,{class:"btn-content",block:"",type:"primary",onClick:se,"native-type":"submit"},{default:g(()=>[J(p(t.$t("\u4FDD\u5B58")),1)]),_:1}),T(E)?n("v-if",!0):(w(),De(ee,{key:0,style:{"margin-top":"16px","background-color":"red","border-radius":"4px","border-color":"red"},block:"",type:"primary",onClick:Fe(P,["stop"]),"native-type":"submit"},{default:g(()=>[J(p(t.$t("\u5220\u9664")),1)]),_:1},8,["onClick"]))])]),_:1})],2)])}}},St=Te(dt,[["__scopeId","data-v-47e02415"],["__file","/Users/wangjun/Downloads/mall-app-h5/src/views/product/components/productEdit.vue"]]);export{St as default};
