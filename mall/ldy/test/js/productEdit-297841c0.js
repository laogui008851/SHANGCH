import{Q as pe,V as fe,a1 as H,d as be,a9 as ge,ab as Te,b as s,Z as _e,$ as he,_ as Ve,j as Ce,l as U,i as ye,v as Se,r as T,bn as O,p as ke,f as q,m as Pe,av as b,I as xe,aP as Ne,c as E,w as g,a as i,n as $e,u as h,ai as we,A as Ie,b9 as De,o as N,t as v,x as Y,e as K,y as Be,M as Me,T as u,al as Ue,J as Oe,K as Ee}from"./index-0001e040.js";/* empty css              */import"./index-259473f6.js";import{C as Ye}from"./index-aebf78fc.js";import"./index-9e9f9536.js";import{F as Fe}from"./index-a602a0f8.js";import{s as ze,d as Re,e as je}from"./product.api-19eafb76.js";import{D as Ge}from"./index-2e9aec07.js";import{B as Le}from"./index-3970dd75.js";import{F as Je}from"./index-da87d95b.js";import{D as oe}from"./function-call-75274e81.js";import"./use-id-a8534a74.js";import"./index-02f58f9d.js";import"./___vite-browser-external_commonjs-proxy-eebe5f73.js";const[Ae,Q]=pe("switch"),He={size:fe,loading:Boolean,disabled:Boolean,modelValue:H,activeColor:String,inactiveColor:String,activeValue:{type:H,default:!0},inactiveValue:{type:H,default:!1}};var qe=be({name:Ae,props:He,emits:["change","update:modelValue"],setup(r,{emit:$,slots:V}){const y=()=>r.modelValue===r.activeValue,F=()=>{if(!r.disabled&&!r.loading){const o=y()?r.inactiveValue:r.activeValue;$("update:modelValue",o),$("change",o)}},z=()=>{if(r.loading){const o=y()?r.activeColor:r.inactiveColor;return s(_e,{class:Q("loading"),color:o},null)}if(V.node)return V.node()};return ge.useCustomFieldValue(()=>r.modelValue),()=>{var o;const{size:R,loading:S,disabled:a,activeColor:w,inactiveColor:t}=r,k=y(),C={fontSize:Te(R),backgroundColor:k?w:t};return s("div",{role:"switch",class:Q({on:k,loading:S,disabled:a}),style:C,tabindex:a?void 0:0,"aria-checked":k,onClick:F},[s("div",{class:Q("node")},[z()]),(o=V.background)==null?void 0:o.call(V)])}}});const Ke=he(qe);const ne=r=>(Oe("data-v-d1ebe5c3"),r=r(),Ee(),r),Qe={class:"editProduct"},Ze={class:"tip pt-2 pb-2 pl-4 pr-4"},We={class:"profit"},Xe={key:0,class:"flex pl-4 pr-4 input-item pt-3 pb-3"},et={class:"flex"},tt={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},lt={class:"flex"},ot={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},nt={class:"flex"},at={class:"tip pt-2 pb-2 pl-4 pr-4"},st=ne(()=>i("span",null,"%",-1)),it={class:"tips pt-2 pb-2 pl-4 pr-4"},ut={class:"tip pt-2 pb-2 pl-4 pr-4"},rt={class:"tip pt-2 pb-2 pl-4 pr-4"},ct={class:"tip pt-2 pb-2 pl-4 pr-4"},dt=ne(()=>i("span",null,"%",-1)),mt={style:{margin:"16px"},class:"pb-8"},vt={__name:"productEdit",setup(r){const $="production",V=Ce(),y=U(()=>{}),F=U(()=>{}),z=ye(),{t:o}=Se.exports.useI18n(),R=we(),S=Ie(),a=T(JSON.parse(R.query.item)),w=T(new Date),t=T({sellingPrice:"",isShelf:0,recTime:0,isCombo:!1,startTime:O(),endTime:O(),discount:"",percent:"",profit:"",id:""}),k=()=>{oe.confirm({title:o("product.21"),message:o("product.22"),confirmButtonText:o("sure"),cancelButtonText:o("cancel")}).then(()=>{Re({sellerGoodsId:t.value.id}).then(()=>{sessionStorage.setItem("currentProductId",a.value.id),sessionStorage.setItem("productDelete",!0),u(o("product.10")),S.go(-1)})}).catch(()=>{})},C=T(!1),P=T(!1),j=T(!1),I=T(""),G=T(""),ae=T(""),L=U(()=>{let e={};return V.userInfo.token?e={...V.userInfo}:S.push("/login"),e});ke(()=>{ue()}),q(()=>t.value.percent,(e,l)=>{}),q(()=>t.value.isCombo,(e,l)=>{e&&(console.log("\u5F00\u5173\u6253\u5F00"),se())}),q(()=>t.value.isShelf,(e,l)=>{console.log("\u5F00\u5173\u6253\u5F00",e),e/1===1&&ie()});const x=T(!1),se=()=>{x.value=!0,M()},D=T(!1),ie=()=>{D.value=!0,M()},c=Pe({min:"",max:""}),ue=()=>{t.value.id=a.value.id,t.value.discountPrice=a.value.discountPrice?b(a.value.discountPrice/1,2,!0):b(a.value.sellingPrice/1,2,!0),t.value.sellingPrice=b(a.value.sellingPrice/1,2,!0),t.value.isShelf=a.value.isShelf/1,t.value.isCombo=Boolean(a.value.isCombo/1),t.value.recTime=a.value.recTime/1,t.value.startTime=a.value.discountStartTime?a.value.discountStartTime.split(" ")[0]:a.value.discountStartTime,t.value.endTime=a.value.discountEndTime?a.value.discountEndTime.split(" ")[0]:a.value.discountEndTime,t.value.profit=b(a.value.profitRatio*100,2,!0),t.value.discount=b(a.value.discountRatio*100,2,!0),t.value.systemPrice=b(a.value.systemPrice/1,2,!0),t.value.percent=b(a.value.profitRatio/1*100,2,!0),c.min=Number(a.value.sysParaMin),c.max=Number(a.value.sysParaMax),ze().then(e=>{c.min=Number(e.sysParaMin),c.max=Number(e.sysParaMax)})},re=()=>{if([].includes($))if(L.value.phoneverif&&L.value.emailverif)M();else{const e=L.value.phoneverif?"bindEmailTips":"\u8BF7\u7ED1\u5B9A\u624B\u673A\u53F7";oe.confirm({title:o("dialogTips"),message:o(e),cancelButtonText:o("cancel"),confirmButtonText:o("gotoSet"),confirmButtonColor:"#1552F0",cancelButtonColor:"#999"}).then(()=>{Ue("/personalInfo")}).catch(()=>{console.log("cancel")})}else M()},B=T(!1),M=()=>{const{startTime:e,endTime:l,discount:p}=t.value;if(e||l){const d=new Date(e.replace(/-/g,"/")+" 00:00:00").getTime(),f=new Date(l.replace(/-/g,"/")+" 00:00:00").getTime();if(!p){u(o("\u8BF7\u8BBE\u7F6E\u6298\u6263\u6BD4\u4F8B"));return}if(d>f){u(o("\u5F00\u59CB\u65F6\u95F4\u5E94\u5C0F\u4E8E\u7ED3\u675F\u65F6\u95F4"));return}}if(Number(p)&&(!e||!l)){u(o("\u8BF7\u6B63\u786E\u586B\u5199\u6D3B\u52A8\u5F00\u542F\u65F6\u95F4\u548C\u7ED3\u675F\u65F6\u95F4"));return}if(!ee()){B.value||(B.value=!0,u.loading({forbidClick:!0,loadingType:"spinner",duration:0}));let d={isShelf:t.value.isShelf?1:0,recTime:t.value.recTime?1:0,isCombo:t.value.isCombo?1:0,sellerGoodsId:a.value.id,startTime:t.value.startTime?t.value.startTime+" 00:00:00":"",endTime:t.value.endTime?t.value.endTime+" 00:00:00":"",discount:b(t.value.discount/100,2,!0),percent:b(t.value.percent/100,2,!0),profit:b(t.value.percent/100,2,!0)};return je(d).then(f=>{u.clear(),B.value=!1,sessionStorage.setItem("currentProductId",a.value.id),x.value?x.value=!1:D.value?D.value=!1:(u(o("product.10")),S.push("/product"))}).catch(f=>{B.value=!1;const m=f.msg;if(x.value=!1,D.value=!1,m.indexOf("\u672A\u8D2D\u4E70")>-1)u(o("\u60A8\u6682\u672A\u8D2D\u4E70\u76F4\u901A\u8F66\u5957\u9910\uFF0C\u8BF7\u8D2D\u4E70\u518D\u8BD5"));else if(m.indexOf("\u5DF2\u5230\u671F")>-1)u(o("\u60A8\u7684\u76F4\u901A\u8F66\u5DF2\u5230\u671F"));else if(m.indexOf("\u6700\u591A\u63A8\u5E7F")>-1){const _=m.split("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A");u(o("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A")+": "+_[1])}else if(m.indexOf("\u672A\u6FC0\u6D3B")>-1)u(o("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(m.indexOf("\u672A\u6FC0\u6D3B")>-1)u(o("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(m.indexOf("\u6700\u5C0F\u4E0B\u67B6")>-1)u(o("\u5C11\u4E8E\u5E97\u94FA\u8BBE\u7F6E\u6700\u5C0F\u4E0B\u67B6\u5546\u54C1\u6570"));else if(m.indexOf("\u9996\u6B21\u4E0A\u67B6")>-1){const _=typeof f.data=="string"?JSON.parse(f.data):f.data;u(o(m,{_$1:_._$1}))}else u(o(m));t.value.isCombo=!1})}},Z=e=>{switch(e){case 1:C.value=!0;break;case 2:P.value=!0;break;case 3:j.value=!0;break}},W=e=>{switch(console.log(I.value),e){case 1:C.value=!1,t.value.startTime=O(I.value).format("YYYY-MM-DD");break;case 2:P.value=!1,t.value.endTime=O(G.value).format("YYYY-MM-DD");break;case 3:j.value=!1,t.value.recTime=ce(ae.value);break}},X=e=>{switch(e){case 1:C.value=!1;break;case 2:P.value=!1;break;case 3:j.value=!1;break}},ce=e=>{let l=e.getFullYear(),p=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,d=e.getDate()<10?"0"+e.getDate():e.getDate(),f=e.getHours()<10?"0"+e.getHours():e.getHours(),m=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),_=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return l+"-"+p+"-"+d+" "+f+":"+m+":"+_},de=U(()=>{let e=0;if(!isNaN(t.value.sellingPrice)&&!isNaN(t.value.discount)){const l=Number(t.value.systemPrice),p=Number(b(Number(t.value.discount)/100,2,!0)),d=Number(t.value.sellingPrice)*(1-p);e=Number(d-l)}return b(e,2,!0)}),J=()=>{const e=Number(t.value.systemPrice),l=Number(b(Number(t.value.percent)/100,2,!0));t.value.sellingPrice=Number(b(e+e*l,2,!0))},ee=()=>{const e=Number(t.value.percent),l=Number(t.value.discount);let p=!1;if(!isNaN(e)){const d=/^\+?[1-9][0-9]*$/;if(!d.test(String(e)))return u(o("\u767E\u5206\u6BD4\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;if(l&&!d.test(String(l)))return u(o("\u6298\u6263\u6BD4\u4F8B\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;e>c.max&&(console.log("12"),t.value.percent=c.max,p=!0,J()),e<c.min&&(console.log("33"),t.value.percent=c.min,p=!0,J())}return p&&c.min&&c.max&&u(o("\u767E\u5206\u6BD4\u8BBE\u7F6E\u8303\u56F4\u4E3A")+`\uFF1A${c.min}% ~ ${c.max}%`),p},me=()=>{const e=Number(t.value.sellingPrice),l=Number(t.value.systemPrice),p=Number(b((e-l)/l*100,2,!0));t.value.percent=p};return(e,l)=>{const p=De,d=Fe,f=Ye,m=Ke,_=xe,A=Ge,te=Ne,le=Le,ve=Je;return N(),E("div",Qe,[s(p,{fixed:""},{title:g(()=>[i("div",null,v(e.$t("\u7F16\u8F91\u5546\u54C1")),1)]),_:1}),i("div",{class:$e(["edit-product-pop",{"is-ar":h(z)}])},[s(ve,null,{default:g(()=>[i("div",Ze,v(e.$t("\u5F53\u524D\u552E\u4EF7")),1),s(f,{class:"input-field",inset:""},{default:g(()=>[s(d,{modelValue:t.value.sellingPrice,"onUpdate:modelValue":l[0]||(l[0]=n=>t.value.sellingPrice=n),type:"number",placeholder:e.$t("\u5F53\u524D\u552E\u4EF7"),onInput:me},{button:g(()=>[i("span",We,v(e.$t("\u5229\u6DA6"))+" "+v(de.value),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),y.value?Y("",!0):(N(),E("div",Xe,[i("div",null,v(e.$t("\u662F\u5426\u4E0A\u67B6")),1),i("div",et,[s(m,{modelValue:t.value.isShelf,"onUpdate:modelValue":l[1]||(l[1]=n=>t.value.isShelf=n),size:"25","inactive-color":"#fff","inactive-value":0,"active-value":1},null,8,["modelValue"])])])),i("div",tt,[i("div",null,v(e.$t("\u662F\u5426\u63A8\u8350")),1),i("div",lt,[s(m,{modelValue:t.value.recTime,"onUpdate:modelValue":l[2]||(l[2]=n=>t.value.recTime=n),"inactive-value":0,"active-value":1,size:"25","inactive-color":"#fff"},null,8,["modelValue"])])]),i("div",ot,[i("div",null,v(e.$t("\u76F4\u901A\u8F66")),1),i("div",nt,[s(m,{loading:x.value,modelValue:t.value.isCombo,"onUpdate:modelValue":l[3]||(l[3]=n=>t.value.isCombo=n),size:"25","inactive-color":"#fff"},null,8,["loading","modelValue"])])]),i("div",at,v(e.$t("\u767E\u5206\u6BD4")),1),s(f,{class:"input-field",inset:""},{default:g(()=>[s(d,{modelValue:t.value.percent,"onUpdate:modelValue":l[4]||(l[4]=n=>t.value.percent=n),type:"number",placeholder:h(o)("\u767E\u5206\u6BD4"),rules:[{required:!0,message:h(o)("\u8BF7\u586B\u5199\u767E\u5206\u6BD4"),max:c.max,min:c.min}],onInput:J,onBlur:ee},{button:g(()=>[st]),_:1},8,["modelValue","placeholder","rules"])]),_:1}),i("div",it,[K(v(e.$t("\u5C06\u9009\u4E2D\u7684\u5546\u54C1\u53D1\u5E03\u5230\u4F60\u7684\u5E97\u94FA\uFF0C\u5E76\u586B\u5199\u5546\u54C1\u5229\u6DA6\u6BD4\u4F8B\uFF0C\u63A8\u8350\u6BD4\u4F8B"))+": ",1),i("span",null,v(c.min)+"%-"+v(c.max)+"%",1)]),i("div",ut,v(e.$t("\u6298\u6263\u5F00\u59CB\u65E5\u671F")),1),s(f,{class:"input-field",inset:"",style:{position:"relative"}},{default:g(()=>[t.value.startTime?(N(),E("div",{key:0,class:"time-clear",onClick:l[5]||(l[5]=n=>t.value.startTime="")},[s(_,{name:"cross"})])):Y("",!0),s(d,{onClickInput:l[6]||(l[6]=n=>Z(1)),modelValue:t.value.startTime,"onUpdate:modelValue":l[7]||(l[7]=n=>t.value.startTime=n),placeholder:h(o)("\u6298\u6263\u5F00\u59CB\u65E5\u671F")},null,8,["modelValue","placeholder"]),s(te,{show:C.value,"onUpdate:show":l[11]||(l[11]=n=>C.value=n),round:"",position:"bottom"},{default:g(()=>[s(A,{"min-date":w.value,"confirm-button-text":e.$t("\u786E\u5B9A"),"cancel-button-text":e.$t("\u53D6\u6D88"),modelValue:I.value,"onUpdate:modelValue":l[8]||(l[8]=n=>I.value=n),type:"date",title:h(o)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:l[9]||(l[9]=n=>W(1)),onCancel:l[10]||(l[10]=n=>X(1))},null,8,["min-date","confirm-button-text","cancel-button-text","modelValue","title"])]),_:1},8,["show"])]),_:1}),i("div",rt,v(e.$t("\u6298\u6263\u7ED3\u675F\u65E5\u671F")),1),s(f,{class:"input-field",inset:"",style:{position:"relative"}},{default:g(()=>[t.value.endTime?(N(),E("div",{key:0,class:"time-clear",onClick:l[12]||(l[12]=n=>t.value.endTime="")},[s(_,{name:"cross"})])):Y("",!0),s(d,{onClickInput:l[13]||(l[13]=n=>Z(2)),modelValue:t.value.endTime,"onUpdate:modelValue":l[14]||(l[14]=n=>t.value.endTime=n),placeholder:h(o)("\u6298\u6263\u7ED3\u675F\u65E5\u671F")},null,8,["modelValue","placeholder"])]),_:1}),i("div",ct,v(e.$t("\u6298\u6263\u6BD4\u4F8B")),1),s(f,{class:"input-field",inset:""},{default:g(()=>[s(d,{modelValue:t.value.discount,"onUpdate:modelValue":l[15]||(l[15]=n=>t.value.discount=n),type:"number",placeholder:h(o)("\u6298\u6263\u6BD4\u4F8B")},{button:g(()=>[dt]),_:1},8,["modelValue","placeholder"])]),_:1}),s(te,{show:P.value,"onUpdate:show":l[19]||(l[19]=n=>P.value=n),round:"",position:"bottom"},{default:g(()=>[s(A,{"min-date":w.value,"cancel-button-text":e.$t("\u53D6\u6D88"),"confirm-button-text":e.$t("\u786E\u5B9A"),modelValue:G.value,"onUpdate:modelValue":l[16]||(l[16]=n=>G.value=n),type:"date",title:h(o)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:l[17]||(l[17]=n=>W(2)),onCancel:l[18]||(l[18]=n=>X(2))},null,8,["min-date","cancel-button-text","confirm-button-text","modelValue","title"])]),_:1},8,["show"]),i("div",mt,[s(le,{class:"btn-content",block:"",type:"primary",onClick:re,"native-type":"submit"},{default:g(()=>[K(v(e.$t("\u4FDD\u5B58")),1)]),_:1}),F.value?Y("",!0):(N(),Be(le,{key:0,style:{"margin-top":"16px","background-color":"red","border-radius":"4px","border-color":"red"},block:"",type:"primary",onClick:Me(k,["stop"]),"native-type":"submit"},{default:g(()=>[K(v(e.$t("\u5220\u9664")),1)]),_:1}))])]),_:1})],2)])}}},Nt=Ve(vt,[["__scopeId","data-v-d1ebe5c3"]]);export{Nt as default};
