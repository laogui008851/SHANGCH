import{Q as ve,V as fe,a1 as q,d as be,a9 as ge,ab as he,b as i,Z as Te,$ as _e,_ as Ce,j as ye,m as E,i as ke,v as Ve,ai as Se,l as Pe,r as T,bz as O,q as $e,f as A,p as xe,av as g,I as we,aP as Ne,c as R,w as h,a as u,y as s,n as Ie,u as C,T as r,b8 as De,o as w,t as v,e as K,z as Be,M as Me,al as Ue,J as Ee,K as Oe}from"./index-19a98339.js";/* empty css              */import"./index-f11ba40f.js";import{C as Re}from"./index-5e9eac9d.js";import"./index-93160a1b.js";import{F as Ye}from"./index-0400f7f8.js";import{s as ze,b as Fe,d as je}from"./product.api-d023c191.js";import{D as Ge}from"./index-d2ec8f31.js";import{B as Le}from"./index-101610a8.js";import{F as He}from"./index-42044eb9.js";import{D as le}from"./function-call-5bd25457.js";import"./use-id-e7d8e724.js";import"./index-c4c1929d.js";import"./___vite-browser-external_commonjs-proxy-17162061.js";const[Je,Q]=ve("switch"),qe={size:fe,loading:Boolean,disabled:Boolean,modelValue:q,activeColor:String,inactiveColor:String,activeValue:{type:q,default:!0},inactiveValue:{type:q,default:!1}};var Ae=be({name:Je,props:qe,emits:["change","update:modelValue"],setup(c,{emit:N,slots:y}){const V=()=>c.modelValue===c.activeValue,Y=()=>{if(!c.disabled&&!c.loading){const l=V()?c.inactiveValue:c.activeValue;N("update:modelValue",l),N("change",l)}},z=()=>{if(c.loading){const l=V()?c.activeColor:c.inactiveColor;return i(Te,{class:Q("loading"),color:l},null)}if(y.node)return y.node()};return ge.useCustomFieldValue(()=>c.modelValue),()=>{var l;const{size:F,loading:S,disabled:n,activeColor:I,inactiveColor:t}=c,P=V(),k={fontSize:he(F),backgroundColor:P?I:t};return i("div",{role:"switch",class:Q({on:P,loading:S,disabled:n}),style:k,tabindex:n?void 0:0,"aria-checked":P,onClick:Y},[i("div",{class:Q("node")},[z()]),(l=y.background)==null?void 0:l.call(y)])}}});const Ke=_e(Ae);const ae=c=>(Ee("data-v-47e02415"),c=c(),Oe(),c),Qe={class:"editProduct"},Ze={class:"tip pt-2 pb-2 pl-4 pr-4"},We={class:"profit"},Xe={key:0,class:"flex pl-4 pr-4 input-item pt-3 pb-3"},et={class:"flex"},tt={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},ot={class:"flex"},lt={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},at={class:"flex"},nt={class:"tip pt-2 pb-2 pl-4 pr-4"},st=ae(()=>u("span",null,"%",-1)),it={class:"tips pt-2 pb-2 pl-4 pr-4"},ut={class:"tip pt-2 pb-2 pl-4 pr-4"},rt={class:"tip pt-2 pb-2 pl-4 pr-4"},ct={class:"tip pt-2 pb-2 pl-4 pr-4"},dt=ae(()=>u("span",null,"%",-1)),mt={style:{margin:"16px"},class:"pb-8"},pt={__name:"productEdit",setup(c){const N="sam-wholesale",y=ye(),V=E(()=>{}),Y=E(()=>{}),z=ke(),{t:l}=Ve.exports.useI18n(),F=Se(),S=Pe(),n=T(JSON.parse(F.query.item)),I=T(new Date),t=T({sellingPrice:"",isShelf:0,recTime:0,isCombo:!1,startTime:O(),endTime:O(),discount:"",percent:"",profit:"",id:""}),P=()=>{le.confirm({title:l("product.21"),message:l("product.22"),confirmButtonText:l("sure"),cancelButtonText:l("cancel")}).then(()=>{je({sellerGoodsId:t.value.id}).then(()=>{sessionStorage.setItem("currentProductId",n.value.id),sessionStorage.setItem("productDelete",!0),r(l("product.10")),S.go(-1)})}).catch(()=>{})},k=T(!1),$=T(!1),j=T(!1),D=T(""),G=T(""),ne=T(""),L=E(()=>{let e={};return y.userInfo.token?e={...y.userInfo}:S.push("/login"),e});$e(()=>{ue()}),A(()=>t.value.percent,(e,o)=>{}),A(()=>t.value.isCombo,(e,o)=>{e&&(console.log("\u5F00\u5173\u6253\u5F00"),se())}),A(()=>t.value.isShelf,(e,o)=>{console.log("\u5F00\u5173\u6253\u5F00",e),e/1===1&&ie()});const x=T(!1),se=()=>{x.value=!0,U()},B=T(!1),ie=()=>{B.value=!0,U()},d=xe({min:"",max:""}),ue=()=>{t.value.id=n.value.id,t.value.discountPrice=n.value.discountPrice?g(n.value.discountPrice/1,2,!0):g(n.value.sellingPrice/1,2,!0),t.value.sellingPrice=g(n.value.sellingPrice/1,2,!0),t.value.isShelf=n.value.isShelf/1,t.value.isCombo=Boolean(n.value.isCombo/1),t.value.recTime=n.value.recTime/1,t.value.startTime=n.value.discountStartTime?n.value.discountStartTime.split(" ")[0]:n.value.discountStartTime,t.value.endTime=n.value.discountEndTime?n.value.discountEndTime.split(" ")[0]:n.value.discountEndTime,t.value.profit=g(n.value.profitRatio*100,2,!0),t.value.discount=g(n.value.discountRatio*100,2,!0),t.value.systemPrice=g(n.value.systemPrice/1,2,!0),t.value.percent=g(n.value.profitRatio/1*100,2,!0),d.min=Number(n.value.sysParaMin),d.max=Number(n.value.sysParaMax),ze().then(e=>{d.min=Number(e.sysParaMin),d.max=Number(e.sysParaMax)})},re=()=>{if([].includes(N))if(L.value.phoneverif&&L.value.emailverif)U();else{const e=L.value.phoneverif?"bindEmailTips":"\u8BF7\u7ED1\u5B9A\u624B\u673A\u53F7";le.confirm({title:l("dialogTips"),message:l(e),cancelButtonText:l("cancel"),confirmButtonText:l("gotoSet"),confirmButtonColor:"#1552F0",cancelButtonColor:"#999"}).then(()=>{Ue("/personalInfo")}).catch(()=>{console.log("cancel")})}else U()},M=T(!1),U=()=>{const{startTime:e,endTime:o,discount:f}=t.value;if(e||o){const m=new Date(e.replace(/-/g,"/")+" 00:00:00").getTime(),b=new Date(o.replace(/-/g,"/")+" 00:00:00").getTime();if(!f){r(l("\u8BF7\u8BBE\u7F6E\u6298\u6263\u6BD4\u4F8B"));return}if(m>b){r(l("\u5F00\u59CB\u65F6\u95F4\u5E94\u5C0F\u4E8E\u7ED3\u675F\u65F6\u95F4"));return}}if(Number(f)&&(!e||!o)){r(l("\u8BF7\u6B63\u786E\u586B\u5199\u6D3B\u52A8\u5F00\u542F\u65F6\u95F4\u548C\u7ED3\u675F\u65F6\u95F4"));return}if(!ee()){M.value||(M.value=!0,r.loading({forbidClick:!0,loadingType:"spinner",duration:0}));let m={isShelf:t.value.isShelf?1:0,recTime:t.value.recTime?1:0,isCombo:t.value.isCombo?1:0,sellerGoodsId:n.value.id,startTime:t.value.startTime?t.value.startTime+" 00:00:00":"",endTime:t.value.endTime?t.value.endTime+" 00:00:00":"",discount:g(t.value.discount/100,2,!0),percent:g(t.value.percent/100,2,!0),profit:g(t.value.percent/100,2,!0)};return Fe(m).then(b=>{r.clear(),M.value=!1,sessionStorage.setItem("currentProductId",n.value.id),x.value?x.value=!1:B.value?B.value=!1:(r(l("product.10")),S.push("/product"))}).catch(b=>{M.value=!1;const p=b.msg;if(x.value=!1,B.value=!1,p.indexOf("\u672A\u8D2D\u4E70")>-1)r(l("\u60A8\u6682\u672A\u8D2D\u4E70\u76F4\u901A\u8F66\u5957\u9910\uFF0C\u8BF7\u8D2D\u4E70\u518D\u8BD5"));else if(p.indexOf("\u5DF2\u5230\u671F")>-1)r(l("\u60A8\u7684\u76F4\u901A\u8F66\u5DF2\u5230\u671F"));else if(p.indexOf("\u6700\u591A\u63A8\u5E7F")>-1){const _=p.split("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A");r(l("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A")+": "+_[1])}else if(p.indexOf("\u672A\u6FC0\u6D3B")>-1)r(l("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(p.indexOf("\u672A\u6FC0\u6D3B")>-1)r(l("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(p.indexOf("\u6700\u5C0F\u4E0B\u67B6")>-1)r(l("\u5C11\u4E8E\u5E97\u94FA\u8BBE\u7F6E\u6700\u5C0F\u4E0B\u67B6\u5546\u54C1\u6570"));else if(p.indexOf("\u9996\u6B21\u4E0A\u67B6")>-1){const _=typeof b.data=="string"?JSON.parse(b.data):b.data;r(l(p,{_$1:_._$1}))}else r(l(p));t.value.isCombo=!1})}},Z=e=>{switch(e){case 1:k.value=!0;break;case 2:$.value=!0;break;case 3:j.value=!0;break}},W=e=>{switch(console.log(D.value),e){case 1:k.value=!1,t.value.startTime=O(D.value).format("YYYY-MM-DD");break;case 2:$.value=!1,t.value.endTime=O(G.value).format("YYYY-MM-DD");break;case 3:j.value=!1,t.value.recTime=ce(ne.value);break}},X=e=>{switch(e){case 1:k.value=!1;break;case 2:$.value=!1;break;case 3:j.value=!1;break}},ce=e=>{let o=e.getFullYear(),f=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,m=e.getDate()<10?"0"+e.getDate():e.getDate(),b=e.getHours()<10?"0"+e.getHours():e.getHours(),p=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),_=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return o+"-"+f+"-"+m+" "+b+":"+p+":"+_},de=E(()=>{let e=0;if(!isNaN(t.value.sellingPrice)&&!isNaN(t.value.discount)){const o=Number(t.value.systemPrice),f=Number(g(Number(t.value.discount)/100,2,!0)),m=Number(t.value.sellingPrice)*(1-f);e=Number(m-o)}return g(e,2,!0)}),H=()=>{const e=Number(t.value.systemPrice),o=Number(g(Number(t.value.percent)/100,2,!0));t.value.sellingPrice=Number(g(e+e*o,2,!0))},ee=()=>{const e=Number(t.value.percent),o=Number(t.value.discount);let f=!1;if(!isNaN(e)){const m=/^\+?[1-9][0-9]*$/;if(!m.test(String(e)))return r(l("\u767E\u5206\u6BD4\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;if(o&&!m.test(String(o)))return r(l("\u6298\u6263\u6BD4\u4F8B\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;e>d.max&&(console.log("12"),t.value.percent=d.max,f=!0,H()),e<d.min&&(console.log("33"),t.value.percent=d.min,f=!0,H())}return f&&d.min&&d.max&&r(l("\u767E\u5206\u6BD4\u8BBE\u7F6E\u8303\u56F4\u4E3A")+`\uFF1A${d.min}% ~ ${d.max}%`),f},me=()=>{const e=Number(t.value.sellingPrice),o=Number(t.value.systemPrice),f=Number(g((e-o)/o*100,2,!0));t.value.percent=f};return(e,o)=>{const f=De,m=Ye,b=Re,p=Ke,_=we,J=Ge,te=Ne,oe=Le,pe=He;return w(),R("div",Qe,[i(f,{fixed:""},{title:h(()=>[u("div",null,v(e.$t("\u7F16\u8F91\u5546\u54C1")),1)]),_:1}),u("div",{class:Ie(["edit-product-pop",{"is-ar":C(z)}])},[s(`        <div class="title">{{$t('\u7F16\u8F91\u5546\u54C1')}}</div>`),i(pe,null,{default:h(()=>[u("div",Ze,v(e.$t("\u5F53\u524D\u552E\u4EF7")),1),i(b,{class:"input-field",inset:""},{default:h(()=>[s(` <van-field v-model="fromData.discountPrice" readonly :placeholder="$t('\u5F53\u524D\u552E\u4EF7')"> `),i(m,{modelValue:t.value.sellingPrice,"onUpdate:modelValue":o[0]||(o[0]=a=>t.value.sellingPrice=a),type:"number",placeholder:e.$t("\u5F53\u524D\u552E\u4EF7"),onInput:me},{button:h(()=>[s(` <span class="profit">{{$t('\u5229\u6DA6')}} {{ (fromData.discountPrice - fromData.systemPrice).toFixed(2) }}</span> `),u("span",We,v(e.$t("\u5229\u6DA6"))+" "+v(de.value),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),V.value?s("v-if",!0):(w(),R("div",Xe,[u("div",null,v(e.$t("\u662F\u5426\u4E0A\u67B6")),1),u("div",et,[i(p,{modelValue:t.value.isShelf,"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.isShelf=a),size:"25","inactive-color":"#fff","inactive-value":0,"active-value":1},null,8,["modelValue"])])])),u("div",tt,[u("div",null,v(e.$t("\u662F\u5426\u63A8\u8350")),1),u("div",ot,[i(p,{modelValue:t.value.recTime,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.recTime=a),"inactive-value":0,"active-value":1,size:"25","inactive-color":"#fff"},null,8,["modelValue"])])]),s(`          <div class="tip pt-2 pb-2 pl-4 pr-4" v-if="fromData.isRecommend">{{$t('\u63A8\u8350\u65F6\u95F4')}}</div>`),s('          <van-cell-group v-if="fromData.isRecommend" class="input-field" inset>'),s(`            <van-field @click-input="onClick(3)"  v-model="fromData.recTime" :placeholder="t('\u63A8\u8350\u65F6\u95F4')">`),s("            </van-field>"),s("          </van-cell-group>"),s('          <van-popup v-model:show="isRecommendShow"'),s("                     round"),s('                     position="bottom"'),s("          >"),s("            <van-datetime-picker"),s(`                :confirm-button-text="$t('\u786E\u5B9A')"`),s(`                :cancel-button-text="$t('\u53D6\u6D88')"`),s('                v-model="recommendTime"'),s('                type="datetime"'),s(`                :title="t('\u9009\u62E9\u5B8C\u6574\u65F6\u95F4')"`),s('                @confirm="onConfirm(3)"'),s('                @cancel="onCancel(3)"'),s("            />"),s("          </van-popup>"),u("div",lt,[u("div",null,v(e.$t("\u76F4\u901A\u8F66")),1),u("div",at,[i(p,{loading:x.value,modelValue:t.value.isCombo,"onUpdate:modelValue":o[3]||(o[3]=a=>t.value.isCombo=a),size:"25","inactive-color":"#fff"},null,8,["loading","modelValue"])])]),u("div",nt,v(e.$t("\u767E\u5206\u6BD4")),1),i(b,{class:"input-field",inset:""},{default:h(()=>[i(m,{modelValue:t.value.percent,"onUpdate:modelValue":o[4]||(o[4]=a=>t.value.percent=a),type:"number",placeholder:C(l)("\u767E\u5206\u6BD4"),rules:[{required:!0,message:C(l)("\u8BF7\u586B\u5199\u767E\u5206\u6BD4"),max:d.max,min:d.min}],onInput:H,onBlur:ee},{button:h(()=>[st]),_:1},8,["modelValue","placeholder","rules"])]),_:1}),u("div",it,[K(v(e.$t("\u5C06\u9009\u4E2D\u7684\u5546\u54C1\u53D1\u5E03\u5230\u4F60\u7684\u5E97\u94FA\uFF0C\u5E76\u586B\u5199\u5546\u54C1\u5229\u6DA6\u6BD4\u4F8B\uFF0C\u63A8\u8350\u6BD4\u4F8B"))+": ",1),u("span",null,v(d.min)+"%-"+v(d.max)+"%",1)]),u("div",ut,v(e.$t("\u6298\u6263\u5F00\u59CB\u65E5\u671F")),1),i(b,{class:"input-field",inset:"",style:{position:"relative"}},{default:h(()=>[t.value.startTime?(w(),R("div",{key:0,class:"time-clear",onClick:o[5]||(o[5]=a=>t.value.startTime="")},[i(_,{name:"cross"})])):s("v-if",!0),i(m,{onClickInput:o[6]||(o[6]=a=>Z(1)),modelValue:t.value.startTime,"onUpdate:modelValue":o[7]||(o[7]=a=>t.value.startTime=a),placeholder:C(l)("\u6298\u6263\u5F00\u59CB\u65E5\u671F")},null,8,["modelValue","placeholder"]),i(te,{show:k.value,"onUpdate:show":o[11]||(o[11]=a=>k.value=a),round:"",position:"bottom"},{default:h(()=>[i(J,{"min-date":I.value,"confirm-button-text":e.$t("\u786E\u5B9A"),"cancel-button-text":e.$t("\u53D6\u6D88"),modelValue:D.value,"onUpdate:modelValue":o[8]||(o[8]=a=>D.value=a),type:"date",title:C(l)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:o[9]||(o[9]=a=>W(1)),onCancel:o[10]||(o[10]=a=>X(1))},null,8,["min-date","confirm-button-text","cancel-button-text","modelValue","title"])]),_:1},8,["show"])]),_:1}),u("div",rt,v(e.$t("\u6298\u6263\u7ED3\u675F\u65E5\u671F")),1),i(b,{class:"input-field",inset:"",style:{position:"relative"}},{default:h(()=>[t.value.endTime?(w(),R("div",{key:0,class:"time-clear",onClick:o[12]||(o[12]=a=>t.value.endTime="")},[i(_,{name:"cross"})])):s("v-if",!0),i(m,{onClickInput:o[13]||(o[13]=a=>Z(2)),modelValue:t.value.endTime,"onUpdate:modelValue":o[14]||(o[14]=a=>t.value.endTime=a),placeholder:C(l)("\u6298\u6263\u7ED3\u675F\u65E5\u671F")},null,8,["modelValue","placeholder"])]),_:1}),u("div",ct,v(e.$t("\u6298\u6263\u6BD4\u4F8B")),1),i(b,{class:"input-field",inset:""},{default:h(()=>[i(m,{modelValue:t.value.discount,"onUpdate:modelValue":o[15]||(o[15]=a=>t.value.discount=a),type:"number",placeholder:C(l)("\u6298\u6263\u6BD4\u4F8B")},{button:h(()=>[dt]),_:1},8,["modelValue","placeholder"])]),_:1}),i(te,{show:$.value,"onUpdate:show":o[19]||(o[19]=a=>$.value=a),round:"",position:"bottom"},{default:h(()=>[i(J,{"min-date":I.value,"cancel-button-text":e.$t("\u53D6\u6D88"),"confirm-button-text":e.$t("\u786E\u5B9A"),modelValue:G.value,"onUpdate:modelValue":o[16]||(o[16]=a=>G.value=a),type:"date",title:C(l)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:o[17]||(o[17]=a=>W(2)),onCancel:o[18]||(o[18]=a=>X(2))},null,8,["min-date","cancel-button-text","confirm-button-text","modelValue","title"])]),_:1},8,["show"]),u("div",mt,[i(oe,{class:"btn-content",block:"",type:"primary",onClick:re,"native-type":"submit"},{default:h(()=>[K(v(e.$t("\u4FDD\u5B58")),1)]),_:1}),Y.value?s("v-if",!0):(w(),Be(oe,{key:0,style:{"margin-top":"16px","background-color":"red","border-radius":"4px","border-color":"red"},block:"",type:"primary",onClick:Me(P,["stop"]),"native-type":"submit"},{default:h(()=>[K(v(e.$t("\u5220\u9664")),1)]),_:1}))])]),_:1})],2)])}}},xt=Ce(pt,[["__scopeId","data-v-47e02415"],["__file","C:/Users/DIY/Desktop/\u6E90\u7801/H5-\u5546\u5BB6/src/views/product/components/productEdit.vue"]]);export{xt as default};
