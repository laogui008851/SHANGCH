import{a4 as fe,a7 as W,P as oe,d as se,bp as $,a3 as me,bq as ve,bf as ie,r as M,l as he,aG as ge,ab as L,ae as ce,f as j,b as d,U as ee,X as ue,b1 as G,aa as F,a2 as be,Q as xe,S as ye,H as Q,br as Ce,Y as Te,bg as te,bs as Ie,Z as we}from"./index-754777e9.js";function R(t){if(!fe(t))return t;if(Array.isArray(t))return t.map(r=>R(r));if(W(t)){const r={};return Object.keys(t).forEach(i=>{r[i]=R(t[i])}),r}return t}const ne=200,ae=300,Oe=15,[re,X]=oe("picker-column");function Pe(t){const{transform:r}=window.getComputedStyle(t),i=r.slice(7,r.length-1).split(", ")[5];return Number(i)}const de=Symbol(re),Z=t=>W(t)&&t.disabled;var Ne=se({name:re,props:{textKey:$(String),readonly:Boolean,allowHtml:Boolean,className:me,itemHeight:$(Number),defaultIndex:ve(0),swipeDuration:$(ee),initialOptions:ie(),visibleItemCount:$(ee)},emits:["change"],setup(t,{emit:r,slots:i}){let h,C,g,c,f;const H=M(),T=M(),l=he({index:t.defaultIndex,offset:0,duration:0,options:R(t.initialOptions)}),w=ge(),O=()=>l.options.length,P=()=>t.itemHeight*(+t.visibleItemCount-1)/2,D=n=>{n=G(n,0,O());for(let o=n;o<O();o++)if(!Z(l.options[o]))return o;for(let o=n-1;o>=0;o--)if(!Z(l.options[o]))return o},m=(n,o)=>{n=D(n)||0;const u=-n*t.itemHeight,v=()=>{n!==l.index&&(l.index=n,o&&r("change",n))};h&&u!==l.offset?f=v:v(),l.offset=u},x=n=>{JSON.stringify(n)!==JSON.stringify(l.options)&&(l.options=R(n),m(t.defaultIndex))},k=n=>{h||t.readonly||(f=null,l.duration=ne,m(n,!0))},S=n=>W(n)&&t.textKey in n?n[t.textKey]:n,N=n=>G(Math.round(-n/t.itemHeight),0,O()-1),_=(n,o)=>{const u=Math.abs(n/o);n=l.offset+u/.003*(n<0?-1:1);const v=N(n);l.duration=+t.swipeDuration,m(v,!0)},V=()=>{h=!1,l.duration=0,f&&(f(),f=null)},E=n=>{if(!t.readonly){if(w.start(n),h){const o=Pe(T.value);l.offset=Math.min(0,o-P()),C=l.offset}else C=l.offset;l.duration=0,g=Date.now(),c=C,f=null}},U=n=>{if(t.readonly)return;w.move(n),w.isVertical()&&(h=!0,ue(n,!0)),l.offset=G(C+w.deltaY.value,-(O()*t.itemHeight),t.itemHeight);const o=Date.now();o-g>ae&&(g=o,c=l.offset)},p=()=>{if(t.readonly)return;const n=l.offset-c,o=Date.now()-g;if(o<ae&&Math.abs(n)>Oe){_(n,o);return}const v=N(l.offset);l.duration=ne,m(v,!0),setTimeout(()=>{h=!1},0)},B=()=>{const n={height:`${t.itemHeight}px`};return l.options.map((o,u)=>{const v=S(o),A=Z(o),J={role:"button",style:n,tabindex:A?-1:0,class:X("item",{disabled:A,selected:u===l.index}),onClick:()=>k(u)},z={class:"van-ellipsis",[t.allowHtml?"innerHTML":"textContent"]:v};return d("li",J,[i.option?i.option(o):d("div",z,null)])})},Y=n=>{const{options:o}=l;for(let u=0;u<o.length;u++)if(S(o[u])===n)return m(u)},K=()=>l.options[l.index],q=()=>l.options.length;return m(l.index),L.useParent(de),ce({state:l,setIndex:m,getValue:K,setValue:Y,setOptions:x,hasOptions:q,stopMomentum:V}),j(()=>t.initialOptions,x),j(()=>t.defaultIndex,n=>m(n)),L.useEventListener("touchmove",U,{target:H}),()=>d("div",{ref:H,class:[X(),t.className],onTouchstartPassive:E,onTouchend:p,onTouchcancel:p},[d("ul",{ref:T,style:{transform:`translate3d(0, ${l.offset+P()}px, 0)`,transitionDuration:`${l.duration}ms`,transitionProperty:l.duration?"all":"none"},class:X("wrapper"),onTransitionend:V},[B()])])}});const[ke,b,le]=oe("picker"),Se={title:String,loading:Boolean,readonly:Boolean,allowHtml:Boolean,itemHeight:F(44),showToolbar:be,swipeDuration:F(1e3),visibleItemCount:F(6),cancelButtonText:String,confirmButtonText:String},Ee=xe({},Se,{columns:ie(),valueKey:String,defaultIndex:F(0),toolbarPosition:ye("top"),columnsFieldNames:Object});var Me=se({name:ke,props:Ee,emits:["confirm","cancel","change"],setup(t,{emit:r,slots:i}){i.default&&console.warn('[Vant] Picker: "default" slot is deprecated, please use "toolbar" slot instead.'),t.valueKey&&console.warn('[Vant] Picker: "valueKey" prop is deprecated, please use "columnsFieldNames" prop instead.');const h=M(!1),C=M(),g=M([]),c=Q(()=>{const{columnsFieldNames:e}=t;return{text:(e==null?void 0:e.text)||t.valueKey||"text",values:(e==null?void 0:e.values)||"values",children:(e==null?void 0:e.children)||"children"}}),{children:f,linkChildren:H}=L.useChildren(de);H();const T=Q(()=>Ce(t.itemHeight)),l=Q(()=>{const e=t.columns[0];if(typeof e=="object"){if(c.value.children in e)return"cascade";if(c.value.values in e)return"object"}return"plain"}),w=()=>{var e;const a=[];let s={[c.value.children]:t.columns};for(;s&&s[c.value.children];){const y=s[c.value.children];let I=(e=s.defaultIndex)!=null?e:+t.defaultIndex;for(;y[I]&&y[I].disabled;)if(I<y.length-1)I++;else{I=0;break}a.push({[c.value.values]:s[c.value.children],className:s.className,defaultIndex:I}),s=y[I]}g.value=a},O=()=>{const{columns:e}=t;l.value==="plain"?g.value=[{[c.value.values]:e}]:l.value==="cascade"?w():g.value=e,h.value=g.value.some(a=>a[c.value.values]&&a[c.value.values].length!==0)||f.some(a=>a.hasOptions)},P=()=>f.map(e=>e.state.index),D=(e,a)=>{const s=f[e];s&&(s.setOptions(a),h.value=!0)},m=e=>{let a={[c.value.children]:t.columns};const s=P();for(let y=0;y<=e;y++)a=a[c.value.children][s[y]];for(;a&&a[c.value.children];)e++,D(e,a[c.value.children]),a=a[c.value.children][a.defaultIndex||0]},x=e=>f[e],k=e=>{const a=x(e);if(a)return a.getValue()},S=(e,a)=>{const s=x(e);s&&(s.setValue(a),l.value==="cascade"&&m(e))},N=e=>{const a=x(e);if(a)return a.state.index},_=(e,a)=>{const s=x(e);s&&(s.setIndex(a),l.value==="cascade"&&m(e))},V=e=>{const a=x(e);if(a)return a.state.options},E=()=>f.map(e=>e.getValue()),U=e=>{e.forEach((a,s)=>{S(s,a)})},p=e=>{e.forEach((a,s)=>{_(s,a)})},B=e=>{l.value==="plain"?r(e,k(0),N(0)):r(e,E(),P())},Y=e=>{l.value==="cascade"&&m(e),l.value==="plain"?r("change",k(0),N(0)):r("change",E(),e)},K=()=>{f.forEach(e=>e.stopMomentum()),B("confirm")},q=()=>B("cancel"),n=()=>{if(i.title)return i.title();if(t.title)return d("div",{class:[b("title"),"van-ellipsis"]},[t.title])},o=()=>{const e=t.cancelButtonText||le("cancel");return d("button",{type:"button",class:[b("cancel"),te],onClick:q},[i.cancel?i.cancel():e])},u=()=>{const e=t.confirmButtonText||le("confirm");return d("button",{type:"button",class:[b("confirm"),te],onClick:K},[i.confirm?i.confirm():e])},v=()=>{if(t.showToolbar){const e=i.toolbar||i.default;return d("div",{class:b("toolbar")},[e?e():[o(),n(),u()]])}},A=()=>g.value.map((e,a)=>{var s;return d(Ne,{textKey:c.value.text,readonly:t.readonly,allowHtml:t.allowHtml,className:e.className,itemHeight:T.value,defaultIndex:(s=e.defaultIndex)!=null?s:+t.defaultIndex,swipeDuration:t.swipeDuration,initialOptions:e[c.value.values],visibleItemCount:t.visibleItemCount,onChange:()=>Y(a)},{option:i.option})}),J=e=>{if(h.value){const a={height:`${T.value}px`},s={backgroundSize:`100% ${(e-T.value)/2}px`};return[d("div",{class:b("mask"),style:s},null),d("div",{class:[Ie,b("frame")],style:a},null)]}},z=()=>{const e=T.value*+t.visibleItemCount,a={height:`${e}px`};return d("div",{ref:C,class:b("columns"),style:a},[A(),J(e)])};return j(()=>t.columns,O,{immediate:!0}),L.useEventListener("touchmove",ue,{target:C}),ce({confirm:K,getValues:E,setValues:U,getIndexes:P,setIndexes:p,getColumnIndex:N,setColumnIndex:_,getColumnValue:k,setColumnValue:S,getColumnValues:V,setColumnValues:D}),()=>{var e,a;return d("div",{class:b()},[t.toolbarPosition==="top"?v():null,t.loading?d(Te,{class:b("loading")},null):null,(e=i["columns-top"])==null?void 0:e.call(i),z(),(a=i["columns-bottom"])==null?void 0:a.call(i),t.toolbarPosition==="bottom"?v():null])}}});const De=we(Me);export{De as P,Se as p};
