import{Q as Y,P as j,d as E,aa as O,r as b,H as $,m as L,p as h,f as x,ae as K,b as Z,ai as B,aP as Q,bt as g,b1 as p,S as ae,bu as S,Z as ne}from"./index-754777e9.js";import{p as R,P as U}from"./index-8b10c6ce.js";const W=Y({},R,{filter:Function,columnsOrder:Array,formatter:{type:Function,default:(e,i)=>i}}),X=Object.keys(R);function A(e,i){if(e<0)return[];const f=Array(e);let s=-1;for(;++s<e;)f[s]=i(s);return f}function ue(e){if(!e)return 0;for(;Number.isNaN(parseInt(e,10));)if(e.length>1)e=e.slice(1);else return 0;return parseInt(e,10)}const G=(e,i)=>32-new Date(e,i-1,32).getDate(),ee=(e,i)=>{const f=["setValues","setIndexes","setColumnIndex","setColumnValue"];return new Proxy(e,{get:(s,o)=>f.includes(o)?(...u)=>{s[o](...u),i()}:s[o]})},[re]=j("time-picker");var q=E({name:re,props:Y({},W,{minHour:O(0),maxHour:O(23),minMinute:O(0),maxMinute:O(59),modelValue:String}),emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:i,slots:f}){const s=r=>{const{minHour:t,maxHour:a,maxMinute:n,minMinute:l}=e;r||(r=`${g(t)}:${g(l)}`);let[c,m]=r.split(":");return c=g(p(+c,+t,+a)),m=g(p(+m,+l,+n)),`${c}:${m}`},o=b(),u=b(s(e.modelValue)),M=$(()=>[{type:"hour",range:[+e.minHour,+e.maxHour]},{type:"minute",range:[+e.minMinute,+e.maxMinute]}]),w=$(()=>M.value.map(({type:r,range:t})=>{let a=A(t[1]-t[0]+1,n=>g(t[0]+n));return e.filter&&(a=e.filter(r,a)),{type:r,values:a}})),k=$(()=>w.value.map(r=>({values:r.values.map(t=>e.formatter(r.type,t))}))),V=()=>{const r=u.value.split(":"),t=[e.formatter("hour",r[0]),e.formatter("minute",r[1])];h(()=>{var a;(a=o.value)==null||a.setValues(t)})},D=()=>{const[r,t]=o.value.getIndexes(),[a,n]=w.value,l=a.values[r]||a.values[0],c=n.values[t]||n.values[0];u.value=s(`${l}:${c}`),V()},P=()=>i("confirm",u.value),F=()=>i("cancel"),_=()=>{D(),h(()=>{h(()=>i("change",u.value))})};return L(()=>{V(),h(D)}),x(k,V),x(()=>[e.filter,e.maxHour,e.minMinute,e.maxMinute],D),x(()=>e.minHour,()=>{h(D)}),x(u,r=>i("update:modelValue",r)),x(()=>e.modelValue,r=>{r=s(r),r!==u.value&&(u.value=r,V())}),K({getPicker:()=>o.value&&ee(o.value,D)}),()=>Z(U,B({ref:o,columns:k.value,onChange:_,onCancel:F,onConfirm:P},Q(e,X)),f)}});const J=new Date().getFullYear(),[oe]=j("date-picker");var z=E({name:oe,props:Y({},W,{type:ae("datetime"),modelValue:Date,minDate:{type:Date,default:()=>new Date(J-10,0,1),validator:S},maxDate:{type:Date,default:()=>new Date(J+10,11,31),validator:S}}),emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:i,slots:f}){const s=t=>{if(S(t)){const a=p(t.getTime(),e.minDate.getTime(),e.maxDate.getTime());return new Date(a)}},o=b(),u=b(s(e.modelValue)),M=(t,a)=>{const n=e[`${t}Date`],l=n.getFullYear();let c=1,m=1,v=0,y=0;return t==="max"&&(c=12,m=G(a.getFullYear(),a.getMonth()+1),v=23,y=59),a.getFullYear()===l&&(c=n.getMonth()+1,a.getMonth()+1===c&&(m=n.getDate(),a.getDate()===m&&(v=n.getHours(),a.getHours()===v&&(y=n.getMinutes())))),{[`${t}Year`]:l,[`${t}Month`]:c,[`${t}Date`]:m,[`${t}Hour`]:v,[`${t}Minute`]:y}},w=$(()=>{const{maxYear:t,maxDate:a,maxMonth:n,maxHour:l,maxMinute:c}=M("max",u.value||e.minDate),{minYear:m,minDate:v,minMonth:y,minHour:I,minMinute:N}=M("min",u.value||e.minDate);let d=[{type:"year",range:[m,t]},{type:"month",range:[y,n]},{type:"day",range:[v,a]},{type:"hour",range:[I,l]},{type:"minute",range:[N,c]}];switch(e.type){case"date":d=d.slice(0,3);break;case"year-month":d=d.slice(0,2);break;case"month-day":d=d.slice(1,3);break;case"datehour":d=d.slice(0,4);break}if(e.columnsOrder){const C=e.columnsOrder.concat(d.map(H=>H.type));d.sort((H,T)=>C.indexOf(H.type)-C.indexOf(T.type))}return d}),k=$(()=>w.value.map(({type:t,range:a})=>{let n=A(a[1]-a[0]+1,l=>g(a[0]+l));return e.filter&&(n=e.filter(t,n)),{type:t,values:n}})),V=$(()=>k.value.map(t=>({values:t.values.map(a=>e.formatter(t.type,a))}))),D=()=>{const t=u.value||e.minDate,{formatter:a}=e,n=k.value.map(l=>{switch(l.type){case"year":return a("year",`${t.getFullYear()}`);case"month":return a("month",g(t.getMonth()+1));case"day":return a("day",g(t.getDate()));case"hour":return a("hour",g(t.getHours()));case"minute":return a("minute",g(t.getMinutes()));default:return""}});h(()=>{var l;(l=o.value)==null||l.setValues(n)})},P=()=>{const{type:t}=e,a=o.value.getIndexes(),n=d=>{let C=0;k.value.forEach((T,te)=>{d===T.type&&(C=te)});const{values:H}=k.value[C];return ue(H[a[C]])};let l,c,m;t==="month-day"?(l=(u.value||e.minDate).getFullYear(),c=n("month"),m=n("day")):(l=n("year"),c=n("month"),m=t==="year-month"?1:n("day"));const v=G(l,c);m=m>v?v:m;let y=0,I=0;t==="datehour"&&(y=n("hour")),t==="datetime"&&(y=n("hour"),I=n("minute"));const N=new Date(l,c-1,m,y,I);u.value=s(N)},F=()=>{i("update:modelValue",u.value),i("confirm",u.value)},_=()=>i("cancel"),r=()=>{P(),h(()=>{P(),h(()=>i("change",u.value))})};return L(()=>{D(),h(P)}),x(V,D),x(u,(t,a)=>i("update:modelValue",a?t:null)),x(()=>[e.filter,e.minDate,e.maxDate],()=>{h(P)}),x(()=>e.modelValue,t=>{var a;t=s(t),t&&t.valueOf()!==((a=u.value)==null?void 0:a.valueOf())&&(u.value=t)}),K({getPicker:()=>o.value&&ee(o.value,P)}),()=>Z(U,B({ref:o,columns:V.value,onChange:r,onCancel:_,onConfirm:F},Q(e,X)),f)}});const[le,ie]=j("datetime-picker"),se=Object.keys(q.props),ce=Object.keys(z.props),me=Y({},q.props,z.props,{modelValue:[String,Date]});var de=E({name:le,props:me,setup(e,{attrs:i,slots:f}){const s=b();return K({getPicker:()=>{var o;return(o=s.value)==null?void 0:o.getPicker()}}),()=>{const o=e.type==="time",u=o?q:z,M=Q(e,o?se:ce);return Z(u,B({ref:s,class:ie()},M,i),f)}}});const ge=ne(de);export{ge as D};
