import{aJ as q,T as A,i as H,bb as F,bc as $,N as K,O as Q}from"./index-754777e9.js";var R={exports:{}},D={exports:{}};(function(y,v){(function(x,d){y.exports=d()})(q,function(){return function(x){var d={};function u(r){if(d[r])return d[r].exports;var s=d[r]={i:r,l:!1,exports:{}};return x[r].call(s.exports,s,s.exports,u),s.l=!0,s.exports}return u.m=x,u.c=d,u.d=function(r,s,g){u.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:g})},u.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},u.t=function(r,s){if(1&s&&(r=u(r)),8&s||4&s&&typeof r=="object"&&r&&r.__esModule)return r;var g=Object.create(null);if(u.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:r}),2&s&&typeof r!="string")for(var b in r)u.d(g,b,function(P){return r[P]}.bind(null,b));return g},u.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return u.d(s,"a",s),s},u.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},u.p="",u(u.s=0)}([function(x,d,u){var r;function s(o){return["image/png","image/jpeg","image/gif"].some(e=>e===o)}u.r(d),u.d(d,"canvastoDataURL",function(){return b}),u.d(d,"canvastoFile",function(){return P}),u.d(d,"dataURLtoFile",function(){return I}),u.d(d,"dataURLtoImage",function(){return j}),u.d(d,"downloadFile",function(){return G}),u.d(d,"filetoDataURL",function(){return E}),u.d(d,"imagetoCanvas",function(){return N}),u.d(d,"urltoBlob",function(){return _}),u.d(d,"urltoImage",function(){return B}),u.d(d,"compress",function(){return C}),u.d(d,"compressAccurately",function(){return S}),u.d(d,"EImageType",function(){return r}),function(o){o.PNG="image/png",o.JPEG="image/jpeg",o.GIF="image/gif"}(r||(r={}));var g=function(o,e,n,t){return new(n||(n=Promise))(function(i,l){function h(c){try{m(t.next(c))}catch(a){l(a)}}function f(c){try{m(t.throw(c))}catch(a){l(a)}}function m(c){var a;c.done?i(c.value):(a=c.value,a instanceof n?a:new n(function(p){p(a)})).then(h,f)}m((t=t.apply(o,e||[])).next())})};function b(o,e=.92,n=r.JPEG){return g(this,void 0,void 0,function*(){return s(n)||(n=r.JPEG),o.toDataURL(n,e)})}function P(o,e=.92,n=r.JPEG){return new Promise(t=>o.toBlob(i=>t(i),n,e))}var w=function(o,e,n,t){return new(n||(n=Promise))(function(i,l){function h(c){try{m(t.next(c))}catch(a){l(a)}}function f(c){try{m(t.throw(c))}catch(a){l(a)}}function m(c){var a;c.done?i(c.value):(a=c.value,a instanceof n?a:new n(function(p){p(a)})).then(h,f)}m((t=t.apply(o,e||[])).next())})};function I(o,e){return w(this,void 0,void 0,function*(){const n=o.split(",");let t=n[0].match(/:(.*?);/)[1];const i=atob(n[1]);let l=i.length;const h=new Uint8Array(l);for(;l--;)h[l]=i.charCodeAt(l);return s(e)&&(t=e),new Blob([h],{type:t})})}function j(o){return new Promise((e,n)=>{const t=new Image;t.onload=()=>e(t),t.onerror=()=>n(new Error("dataURLtoImage(): dataURL is illegal")),t.src=o})}function G(o,e){const n=document.createElement("a");n.href=window.URL.createObjectURL(o),n.download=e||Date.now().toString(36),document.body.appendChild(n);const t=document.createEvent("MouseEvents");t.initEvent("click",!1,!1),n.dispatchEvent(t),document.body.removeChild(n)}function E(o){return new Promise(e=>{const n=new FileReader;n.onloadend=t=>e(t.target.result),n.readAsDataURL(o)})}var T=function(o,e,n,t){return new(n||(n=Promise))(function(i,l){function h(c){try{m(t.next(c))}catch(a){l(a)}}function f(c){try{m(t.throw(c))}catch(a){l(a)}}function m(c){var a;c.done?i(c.value):(a=c.value,a instanceof n?a:new n(function(p){p(a)})).then(h,f)}m((t=t.apply(o,e||[])).next())})};function N(o,e={}){return T(this,void 0,void 0,function*(){const n=Object.assign({},e),t=document.createElement("canvas"),i=t.getContext("2d");let l,h;for(const f in n)Object.prototype.hasOwnProperty.call(n,f)&&(n[f]=Number(n[f]));if(n.scale){const f=n.scale>0&&n.scale<10?n.scale:1;h=o.width*f,l=o.height*f}else h=n.width||n.height*o.width/o.height||o.width,l=n.height||n.width*o.height/o.width||o.height;switch([5,6,7,8].some(f=>f===n.orientation)?(t.height=h,t.width=l):(t.height=l,t.width=h),n.orientation){case 3:i.rotate(180*Math.PI/180),i.drawImage(o,-t.width,-t.height,t.width,t.height);break;case 6:i.rotate(90*Math.PI/180),i.drawImage(o,0,-t.width,t.height,t.width);break;case 8:i.rotate(270*Math.PI/180),i.drawImage(o,-t.height,0,t.height,t.width);break;case 2:i.translate(t.width,0),i.scale(-1,1),i.drawImage(o,0,0,t.width,t.height);break;case 4:i.translate(t.width,0),i.scale(-1,1),i.rotate(180*Math.PI/180),i.drawImage(o,-t.width,-t.height,t.width,t.height);break;case 5:i.translate(t.width,0),i.scale(-1,1),i.rotate(90*Math.PI/180),i.drawImage(o,0,-t.width,t.height,t.width);break;case 7:i.translate(t.width,0),i.scale(-1,1),i.rotate(270*Math.PI/180),i.drawImage(o,-t.height,0,t.height,t.width);break;default:i.drawImage(o,0,0,t.width,t.height)}return t})}function _(o){return fetch(o).then(e=>e.blob())}function B(o){return new Promise((e,n)=>{const t=new Image;t.onload=()=>e(t),t.onerror=()=>n(new Error("urltoImage(): Image failed to load, please check the image URL")),t.src=o})}var L=function(o,e,n,t){return new(n||(n=Promise))(function(i,l){function h(c){try{m(t.next(c))}catch(a){l(a)}}function f(c){try{m(t.throw(c))}catch(a){l(a)}}function m(c){var a;c.done?i(c.value):(a=c.value,a instanceof n?a:new n(function(p){p(a)})).then(h,f)}m((t=t.apply(o,e||[])).next())})};function C(o,e={}){return L(this,void 0,void 0,function*(){if(!(o instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if(typeof e!="object"&&(e=Object.assign({quality:e})),e.quality=Number(e.quality),Number.isNaN(e.quality))return o;const n=yield E(o);let t=n.split(",")[0].match(/:(.*?);/)[1],i=r.JPEG;s(e.type)&&(i=e.type,t=e.type);const l=yield j(n),h=yield N(l,Object.assign({},e)),f=yield b(h,e.quality,i),m=yield I(f,t);return m.size>o.size?o:m})}function S(o,e={}){return L(this,void 0,void 0,function*(){if(!(o instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if(typeof e!="object"&&(e=Object.assign({size:e})),e.size=Number(e.size),Number.isNaN(e.size)||1024*e.size>o.size)return o;e.accuracy=Number(e.accuracy),(!e.accuracy||e.accuracy<.8||e.accuracy>.99)&&(e.accuracy=.95);const n=e.size*(2-e.accuracy)*1024,t=1024*e.size,i=e.size*e.accuracy*1024,l=yield E(o);let h=l.split(",")[0].match(/:(.*?);/)[1],f=r.JPEG;s(e.type)&&(f=e.type,h=e.type);const m=yield j(l),c=yield N(m,Object.assign({},e));let a,p=.5;const z=[null,null];for(let M=1;M<=7;M++){a=yield b(c,p,f);const O=.75*a.length;if(M===7){(n<O||i>O)&&(a=[a,...z].filter(k=>k).sort((k,J)=>Math.abs(.75*k.length-t)-Math.abs(.75*J.length-t))[0]);break}if(n<O)z[1]=a,p-=Math.pow(.5,M+1);else{if(!(i>O))break;z[0]=a,p+=Math.pow(.5,M+1)}}const U=yield I(a,h);return U.size>o.size?o:U})}}])})})(D);(function(y){y.exports=D.exports})(R);const W=(y,v)=>{var r;if(!(y.file.size/1024/1024<10))return A.fail("\u4E0A\u4F20\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 10MB!"),!1;const d=H(),u=(r=d==null?void 0:d.userInfo)==null?void 0:r.token;return new Promise((s,g)=>{R.exports.compress(y.file,.6).then(b=>{const P=new FormData;P.append("file",b),console.log(F),$.post(`${F}/wap/public/uploadimg!execute.action?token=${u}`,P,{onDownloadProgress:w=>{console.log(w),w.lengthComputeable&&v((w.loaded/w.total*100).toFixed(2))}},{headers:{"Content-Type":"multipart/form-data"},timeout:5e3}).then(w=>{const{code:I,data:j}=w.data;I/1===0&&s(j)}).catch(w=>{g(w)})})})},X=y=>{const v=new FormData;return v.append("file",y.file),v.append("moduleName",y.moduleName),K({url:"/wap/api/uploadimg!execute.action",method:Q.POST,data:v})};export{W as _,X as u};
