import{P as B,d as O,bp as Y,U as N,l as F,aG as oe,r as L,H as p,f as b,ab as U,b as r,X as $,b1 as T,Y as te,ae,m as se,aX as ne,aY as ie,p as ce,ai as j,aP as le,aQ as re,a2 as Z,bf as me,aa as H,a3 as k,S as A,bg as ue,I as ve,aR as de,aU as ge,Q as he,Z as fe,aV as we,aW as Pe}from"./index-754777e9.js";import{S as xe,a as Ie}from"./index-aea96d27.js";import{I as Ce}from"./index-7e9868ca.js";const _=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),E=B("image-preview")[1];var Se=O({props:{src:String,show:Boolean,active:Number,minZoom:Y(N),maxZoom:Y(N),rootWidth:Y(Number),rootHeight:Y(Number)},emits:["scale","close"],setup(o,{emit:c}){const e=F({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=oe(),i=L(),d=p(()=>{const{rootWidth:t,rootHeight:s}=o,n=s/t;return e.imageRatio>n}),W=p(()=>{const{scale:t,moveX:s,moveY:n,moving:v,zooming:C}=e,X={transitionDuration:C||v?"0s":".3s"};if(t!==1){const J=s/t,ee=n/t;X.transform=`scale(${t}, ${t}) translate(${J}px, ${ee}px)`}return X}),g=p(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s/e.imageRatio:t;return Math.max(0,(e.scale*n-t)/2)}return 0}),h=p(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s:t*e.imageRatio;return Math.max(0,(e.scale*n-s)/2)}return 0}),f=t=>{t=T(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,c("scale",{scale:t,index:o.active}))},y=()=>{f(1),e.moveX=0,e.moveY=0},z=()=>{const t=e.scale>1?1:2;f(t),e.moveX=0,e.moveY=0};let w,P,x,I,a,m,u;const Q=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),w=s.length,P=e.moveX,x=e.moveY,u=Date.now(),e.moving=w===1&&e.scale!==1,e.zooming=w===2&&!n.value,e.zooming&&(I=e.scale,a=_(t.touches))},V=t=>{const{touches:s}=t;if(l.move(t),(e.moving||e.zooming)&&$(t,!0),e.moving){const{deltaX:n,deltaY:v}=l,C=n.value+P,X=v.value+x;e.moveX=T(C,-g.value,g.value),e.moveY=T(X,-h.value,h.value)}if(e.zooming&&s.length===2){const n=_(s),v=I*n/a;f(v)}},G=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=l,n=Date.now()-u,v=250,C=5;t.value<C&&s.value<C&&n<v&&(m?(clearTimeout(m),m=null,z()):m=setTimeout(()=>{c("close"),m=null},v))},M=t=>{let s=!1;(e.moving||e.zooming)&&(s=!0,e.moving&&P===e.moveX&&x===e.moveY&&(s=!1),t.touches.length||(e.zooming&&(e.moveX=T(e.moveX,-g.value,g.value),e.moveY=T(e.moveY,-h.value,h.value),e.zooming=!1),e.moving=!1,P=0,x=0,I=1,e.scale<1&&y(),e.scale>o.maxZoom&&(e.scale=+o.maxZoom))),$(t,s),G(),l.reset()},K=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;e.imageRatio=n/s};return b(()=>o.active,y),b(()=>o.show,t=>{t||y()}),U.useEventListener("touchmove",V,{target:p(()=>{var t;return(t=i.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>r(te,{type:"spinner"},null)};return r(xe,{ref:i,class:E("swipe-item"),onTouchstartPassive:Q,onTouchend:M,onTouchcancel:M},{default:()=>[r(Ce,{src:o.src,fit:"contain",class:E("image",{vertical:d.value}),style:W.value,onLoad:K},t)]})}}});const[ye,S]=B("image-preview"),pe=["show","transition","overlayStyle","closeOnPopstate"],Te={show:Boolean,loop:Z,images:me(),minZoom:H(1/3),maxZoom:H(3),overlay:Z,closeable:Boolean,showIndex:Z,className:k,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:H(300),startPosition:H(0),showIndicators:Boolean,closeOnPopstate:Z,closeIconPosition:A("top-right")};var q=O({name:ye,props:Te,emits:["scale","close","closed","change","update:show"],setup(o,{emit:c,slots:e}){const l=L(),i=F({active:0,rootWidth:0,rootHeight:0}),d=()=>{if(l.value){const a=U.useRect(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},W=a=>c("scale",a),g=a=>c("update:show",a),h=()=>{de(o.beforeClose,{args:[i.active],done:()=>g(!1)})},f=a=>{a!==i.active&&(i.active=a,c("change",a))},y=()=>{if(o.showIndex)return r("div",{class:S("index")},[e.index?e.index({index:i.active}):`${i.active+1} / ${o.images.length}`])},z=()=>{if(e.cover)return r("div",{class:S("cover")},[e.cover()])},w=()=>r(Ie,{ref:l,lazyRender:!0,loop:o.loop,class:S("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:f},{default:()=>[o.images.map(a=>r(Se,{src:a,show:o.show,active:i.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:W,onClose:h},null))]}),P=()=>{if(o.closeable)return r(ve,{role:"button",name:o.closeIcon,class:[S("close-icon",o.closeIconPosition),ue],onClick:h},null)},x=()=>c("closed"),I=(a,m)=>{var u;return(u=l.value)==null?void 0:u.swipeTo(a,m)};return ae({swipeTo:I}),se(d),b([ne,ie],d),b(()=>o.startPosition,a=>f(+a)),b(()=>o.show,a=>{const{images:m,startPosition:u}=o;a?(f(+u),ce(()=>{d(),I(+u,{immediate:!0})})):c("close",{index:i.active,url:m[i.active]})}),()=>r(re,j({class:[S(),o.className],overlayClass:[S("overlay"),o.overlayClass],onClosed:x,"onUpdate:show":g},le(o,pe)),{default:()=>[P(),w(),y(),z()]})}});let R;const be={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Xe(){({instance:R}=we({setup(){const{state:o,toggle:c}=Pe(),e=()=>{o.images=[]};return()=>r(q,j(o,{onClosed:e,"onUpdate:show":c}),null)}}))}const D=(o,c=0)=>{if(!!ge)return R||Xe(),o=Array.isArray(o)?{images:o,startPosition:c}:o,R.open(he({},be,o)),R};D.Component=fe(q);D.install=o=>{o.use(D.Component)};export{D as I};
