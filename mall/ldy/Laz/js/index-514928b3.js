import{Q as B,d as O,bk as Y,V as D,p as F,aF as oe,r as L,m as T,f as b,a9 as U,b as r,Y as M,b0 as p,Z as te,ac as ae,q as se,aW as ne,aX as ie,s as ce,ag as q,aO as le,aP as re,a0 as Z,bs as me,a8 as H,a1 as N,U as A,bt as ue,I as ve,aQ as de,aT as ge,R as he,$ as fe,aU as we,aV as Pe}from"./index-9e7fbb1d.js";import{S as xe,a as Ie}from"./index-c3a65373.js";import{I as Ce}from"./index-7160bc73.js";const _=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),E=B("image-preview")[1];var ye=O({props:{src:String,show:Boolean,active:Number,minZoom:Y(D),maxZoom:Y(D),rootWidth:Y(Number),rootHeight:Y(Number)},emits:["scale","close"],setup(o,{emit:c}){const e=F({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=oe(),i=L(),d=T(()=>{const{rootWidth:t,rootHeight:s}=o,n=s/t;return e.imageRatio>n}),W=T(()=>{const{scale:t,moveX:s,moveY:n,moving:v,zooming:C}=e,X={transitionDuration:C||v?"0s":".3s"};if(t!==1){const J=s/t,ee=n/t;X.transform=`scale(${t}, ${t}) translate(${J}px, ${ee}px)`}return X}),g=T(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s/e.imageRatio:t;return Math.max(0,(e.scale*n-t)/2)}return 0}),h=T(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s:t*e.imageRatio;return Math.max(0,(e.scale*n-s)/2)}return 0}),f=t=>{t=p(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,c("scale",{scale:t,index:o.active}))},S=()=>{f(1),e.moveX=0,e.moveY=0},z=()=>{const t=e.scale>1?1:2;f(t),e.moveX=0,e.moveY=0};let w,P,x,I,a,m,u;const j=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),w=s.length,P=e.moveX,x=e.moveY,u=Date.now(),e.moving=w===1&&e.scale!==1,e.zooming=w===2&&!n.value,e.zooming&&(I=e.scale,a=_(t.touches))},Q=t=>{const{touches:s}=t;if(l.move(t),(e.moving||e.zooming)&&M(t,!0),e.moving){const{deltaX:n,deltaY:v}=l,C=n.value+P,X=v.value+x;e.moveX=p(C,-g.value,g.value),e.moveY=p(X,-h.value,h.value)}if(e.zooming&&s.length===2){const n=_(s),v=I*n/a;f(v)}},K=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=l,n=Date.now()-u,v=250,C=5;t.value<C&&s.value<C&&n<v&&(m?(clearTimeout(m),m=null,z()):m=setTimeout(()=>{c("close"),m=null},v))},k=t=>{let s=!1;(e.moving||e.zooming)&&(s=!0,e.moving&&P===e.moveX&&x===e.moveY&&(s=!1),t.touches.length||(e.zooming&&(e.moveX=p(e.moveX,-g.value,g.value),e.moveY=p(e.moveY,-h.value,h.value),e.zooming=!1),e.moving=!1,P=0,x=0,I=1,e.scale<1&&S(),e.scale>o.maxZoom&&(e.scale=+o.maxZoom))),M(t,s),K(),l.reset()},G=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;e.imageRatio=n/s};return b(()=>o.active,S),b(()=>o.show,t=>{t||S()}),U.useEventListener("touchmove",Q,{target:T(()=>{var t;return(t=i.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>r(te,{type:"spinner"},null)};return r(xe,{ref:i,class:E("swipe-item"),onTouchstartPassive:j,onTouchend:k,onTouchcancel:k},{default:()=>[r(Ce,{src:o.src,fit:"contain",class:E("image",{vertical:d.value}),style:W.value,onLoad:G},t)]})}}});const[Se,y]=B("image-preview"),Te=["show","transition","overlayStyle","closeOnPopstate"],pe={show:Boolean,loop:Z,images:me(),minZoom:H(1/3),maxZoom:H(3),overlay:Z,closeable:Boolean,showIndex:Z,className:N,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayClass:N,overlayStyle:Object,swipeDuration:H(300),startPosition:H(0),showIndicators:Boolean,closeOnPopstate:Z,closeIconPosition:A("top-right")};var V=O({name:Se,props:pe,emits:["scale","close","closed","change","update:show"],setup(o,{emit:c,slots:e}){const l=L(),i=F({active:0,rootWidth:0,rootHeight:0}),d=()=>{if(l.value){const a=U.useRect(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},W=a=>c("scale",a),g=a=>c("update:show",a),h=()=>{de(o.beforeClose,{args:[i.active],done:()=>g(!1)})},f=a=>{a!==i.active&&(i.active=a,c("change",a))},S=()=>{if(o.showIndex)return r("div",{class:y("index")},[e.index?e.index({index:i.active}):`${i.active+1} / ${o.images.length}`])},z=()=>{if(e.cover)return r("div",{class:y("cover")},[e.cover()])},w=()=>r(Ie,{ref:l,lazyRender:!0,loop:o.loop,class:y("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:f},{default:()=>[o.images.map(a=>r(ye,{src:a,show:o.show,active:i.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:W,onClose:h},null))]}),P=()=>{if(o.closeable)return r(ve,{role:"button",name:o.closeIcon,class:[y("close-icon",o.closeIconPosition),ue],onClick:h},null)},x=()=>c("closed"),I=(a,m)=>{var u;return(u=l.value)==null?void 0:u.swipeTo(a,m)};return ae({swipeTo:I}),se(d),b([ne,ie],d),b(()=>o.startPosition,a=>f(+a)),b(()=>o.show,a=>{const{images:m,startPosition:u}=o;a?(f(+u),ce(()=>{d(),I(+u,{immediate:!0})})):c("close",{index:i.active,url:m[i.active]})}),()=>r(re,q({class:[y(),o.className],overlayClass:[y("overlay"),o.overlayClass],onClosed:x,"onUpdate:show":g},le(o,Te)),{default:()=>[P(),w(),S(),z()]})}});let R;const be={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Xe(){({instance:R}=we({setup(){const{state:o,toggle:c}=Pe(),e=()=>{o.images=[]};return()=>r(V,q(o,{onClosed:e,"onUpdate:show":c}),null)}}))}const $=(o,c=0)=>{if(!!ge)return R||Xe(),o=Array.isArray(o)?{images:o,startPosition:c}:o,R.open(he({},be,o)),R};$.Component=fe(V);$.install=o=>{o.use($.Component)};export{$ as I};
