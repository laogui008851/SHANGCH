"use strict";(self["webpackChunkshop"]=self["webpackChunkshop"]||[]).push([[4586],{57402:function(t,e,i){i.r(e),i.d(e,{default:function(){return v}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-content"},[e("van-nav-bar",{attrs:{"safe-area-inset-top":"",fixed:"",title:t.$t("评价"),"left-arrow":""},on:{"click-left":()=>t.$router.back()}}),e("div",{staticStyle:{width:"100%",height:"46px"}}),t.goodsData.length?e("div",{staticClass:"evaluate-content"},[t._l(t.goodsData,(function(i,n){return e("div",{key:n,staticClass:"item"},[e("div",{staticClass:"goods-info"},[e("div",{staticClass:"poster"},[e("img",{attrs:{src:i.goodsIcon,alt:""}})]),e("div",{staticClass:"info"},[e("p",{staticClass:"name"},[t._v(t._s(i.goodsName?.length>27?i.goodsName.slice(0,27)+"...":i.goodsName))]),e("p",{staticClass:"price"},[t._v("$ "+t._s(t.priceFormat(i.goodsReal)))]),e("van-rate",{staticClass:"rate-wrap",attrs:{size:15,":color":t.mainColor,"void-icon":"star","void-color":"#D9D9D9"},model:{value:i.rating,callback:function(e){t.$set(i,"rating",e)},expression:"item.rating"}})],1)]),e("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:4},placeholder:t.$t("请输入评价信息"),resize:"none",maxlength:"1000","show-word-limit":""},model:{value:i.content,callback:function(e){t.$set(i,"content",e)},expression:"item.content"}}),e("div",{staticClass:"evaluate-title"},[t._v(t._s(t.$t("评价晒图")))]),e("van-uploader",{attrs:{"after-read":t.afterRead,name:n,"max-count":9,accept:".png,.jpg,.jpeg"},model:{value:i.fileList,callback:function(e){t.$set(i,"fileList",e)},expression:"item.fileList"}})],1)})),e("div",{staticClass:"submit-btn",on:{click:t.submitHandle}},[t._v(t._s(t.$t("提交评论")))])],2):t._e()],1)},a=[],s=(i(42511),i(29538)),r=(i(19066),i(87740)),o=(i(37850),i(88848)),l=(i(83627),i(90797)),c=i(14970),u=i(10408),d=i(89158),h=i(15941),f={name:"OrderEvaluate",components:{[l.Z.name]:l.Z,[o.Z.name]:o.Z,[r.Z.name]:r.Z,[s.Z.name]:s.Z},data(){return{mainColor:"#1A4E8A",fileList:[],cancelShow:!1,remindShow:!1,currentData:null,orderId:null,goodsData:[]}},mounted(){this.$nextTick((()=>{const{id:t}=this.$route.query;t?(this.orderId=t,this.getOrderGoods()):((0,o.Z)(this.$t("订单号不存在")),setTimeout((()=>{this.$router.back()}),1500))}))},methods:{afterRead(t,{name:e}){let i=this.goodsData[e].fileList.length;o.Z.loading({duration:0,message:this.$t("上传中"),forbidClick:!0});let n=new FormData;n.append("file",t.file),n.append("moduleName","selle");(0,d.VU)(n).then((t=>{h.log("图片上传成功",t),this.goodsData[e][`imgUrl${i}`]=t})).catch((t=>{this.fileList=[],this.$notify(this.$t("上传失败"))})).finally((()=>{o.Z.clear()}))},priceFormat(t){return(0,u.XY)(t)},getOrderGoods(){o.Z.loading({duration:0,message:this.$t("请求中"),forbidClick:!0}),(0,c.K7)({orderId:this.orderId}).then((t=>{const e=t.pageList||[];e.forEach((t=>{t.rating=5,t.content=""})),this.goodsData=e,o.Z.clear()})).catch((()=>{o.Z.clear()}))},async submitHandle(){const t=this.goodsData.map((t=>{const{rating:e,content:i,goodsId:n}=t;let a="1";a=e<2?"3":e<4?"2":"1";let s={orderId:this.orderId,sellerGoodsId:n,rating:e,content:i,evaluationType:a};return Object.keys(t).forEach((e=>{-1!==e.indexOf("imgUrl")&&(s[e]=t[e])})),s}));o.Z.loading({duration:0,message:this.$t("提交中"),forbidClick:!0});for(let e=0;e<t.length;e++)await(0,c.MR)(t[e]);o.Z.success(this.$t("成功")),setTimeout((()=>{this.$router.back()}),1e3)}}},p=f,m=i(1001),g=(0,m.Z)(p,n,a,!1,null,"b97da806",null),v=g.exports},35065:function(t,e,i){i.d(e,{f:function(){return n}});var n={inject:{vanField:{default:null}},watch:{value:function(){var t=this.vanField;t&&(t.resetValidation(),t.validateWithTrigger("onChange"))}},created:function(){var t=this.vanField;t&&!t.children&&(t.children=this)}}},87740:function(t,e,i){var n=i(32667),a=i(80408),s=i(85781),r=i(93969),o=i(35065),l=i(19858),c=(0,n.d)("rate"),u=c[0],d=c[1];function h(t,e,i){return t>=e?"full":t+.5>=e&&i?"half":"void"}e["Z"]=u({mixins:[r.D,o.f],props:{size:[Number,String],color:String,gutter:[Number,String],readonly:Boolean,disabled:Boolean,allowHalf:Boolean,voidColor:String,iconPrefix:String,disabledColor:String,value:{type:Number,default:0},icon:{type:String,default:"star"},voidIcon:{type:String,default:"star-o"},count:{type:[Number,String],default:5},touchable:{type:Boolean,default:!0}},computed:{list:function(){for(var t=[],e=1;e<=this.count;e++)t.push(h(this.value,e,this.allowHalf));return t},sizeWithUnit:function(){return(0,a.N)(this.size)},gutterWithUnit:function(){return(0,a.N)(this.gutter)}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{select:function(t){this.disabled||this.readonly||t===this.value||(this.$emit("input",t),this.$emit("change",t))},onTouchStart:function(t){var e=this;if(!this.readonly&&!this.disabled&&this.touchable){this.touchStart(t);var i=this.$refs.items.map((function(t){return t.getBoundingClientRect()})),n=[];i.forEach((function(t,i){e.allowHalf?n.push({score:i+.5,left:t.left},{score:i+1,left:t.left+t.width/2}):n.push({score:i+1,left:t.left})})),this.ranges=n}},onTouchMove:function(t){if(!this.readonly&&!this.disabled&&this.touchable&&(this.touchMove(t),"horizontal"===this.direction)){(0,s.PF)(t);var e=t.touches[0].clientX;this.select(this.getScoreByPosition(e))}},getScoreByPosition:function(t){for(var e=this.ranges.length-1;e>0;e--)if(t>this.ranges[e].left)return this.ranges[e].score;return this.allowHalf?.5:1},genStar:function(t,e){var i,n=this,a=this.$createElement,s=this.icon,r=this.color,o=this.count,c=this.voidIcon,u=this.disabled,h=this.voidColor,f=this.disabledColor,p=e+1,m="full"===t,g="void"===t;return this.gutterWithUnit&&p!==+o&&(i={paddingRight:this.gutterWithUnit}),a("div",{ref:"items",refInFor:!0,key:e,attrs:{role:"radio",tabindex:"0","aria-setsize":o,"aria-posinset":p,"aria-checked":String(!g)},style:i,class:d("item")},[a(l.Z,{attrs:{size:this.sizeWithUnit,name:m?s:c,color:u?f:m?r:h,classPrefix:this.iconPrefix,"data-score":p},class:d("icon",{disabled:u,full:m}),on:{click:function(){n.select(p)}}}),this.allowHalf&&a(l.Z,{attrs:{size:this.sizeWithUnit,name:g?c:s,color:u?f:g?h:r,classPrefix:this.iconPrefix,"data-score":p-.5},class:d("icon",["half",{disabled:u,full:!g}]),on:{click:function(){n.select(p-.5)}}})])}},render:function(){var t=this,e=arguments[0];return e("div",{class:d({readonly:this.readonly,disabled:this.disabled}),attrs:{tabindex:"0",role:"radiogroup"}},[this.list.map((function(e,i){return t.genStar(e,i)}))])}})},19066:function(t,e,i){i(22184),i(14106),i(4127)},29538:function(t,e,i){i.d(e,{Z:function(){return Z}});var n=i(39299),a=i(53370),s=i(32667),r=i(80408);function o(t){return Array.isArray(t)?t:[t]}function l(t,e){return new Promise((function(i){if("file"!==e){var n=new FileReader;n.onload=function(t){i(t.target.result)},"dataUrl"===e?n.readAsDataURL(t):"text"===e&&n.readAsText(t)}else i(null)}))}function c(t,e){return o(t).some((function(t){return!!t&&((0,a.mf)(e)?e(t):t.size>e)}))}var u=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function d(t){return u.test(t)}function h(t){return!!t.isImage||(t.file&&t.file.type?0===t.file.type.indexOf("image"):t.url?d(t.url):!!t.content&&0===t.content.indexOf("data:image"))}var f=i(35065),p=i(19858),m=i(84639),g=i(94958),v=i(76471),w=(0,s.d)("uploader"),b=w[0],y=w[1],Z=b({inheritAttrs:!1,mixins:[f.f],model:{prop:"fileList"},props:{disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],previewOptions:Object,name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:[Number,String,Function],default:Number.MAX_VALUE},maxCount:{type:[Number,String],default:Number.MAX_VALUE},deletable:{type:Boolean,default:!0},showUpload:{type:Boolean,default:!0},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"},uploadIcon:{type:String,default:"photograph"}},computed:{previewSizeWithUnit:function(){return(0,r.N)(this.previewSize)},value:function(){return this.fileList}},created:function(){this.urls=[]},beforeDestroy:function(){this.urls.forEach((function(t){return URL.revokeObjectURL(t)}))},methods:{getDetail:function(t){return void 0===t&&(t=this.fileList.length),{name:this.name,index:t}},onChange:function(t){var e=this,i=t.target.files;if(!this.disabled&&i.length){if(i=1===i.length?i[0]:[].slice.call(i),this.beforeRead){var n=this.beforeRead(i,this.getDetail());if(!n)return void this.resetInput();if((0,a.tI)(n))return void n.then((function(t){t?e.readFile(t):e.readFile(i)})).catch(this.resetInput)}this.readFile(i)}},readFile:function(t){var e=this,i=c(t,this.maxSize);if(Array.isArray(t)){var n=this.maxCount-this.fileList.length;t.length>n&&(t=t.slice(0,n)),Promise.all(t.map((function(t){return l(t,e.resultType)}))).then((function(n){var a=t.map((function(t,e){var i={file:t,status:"",message:""};return n[e]&&(i.content=n[e]),i}));e.onAfterRead(a,i)}))}else l(t,this.resultType).then((function(n){var a={file:t,status:"",message:""};n&&(a.content=n),e.onAfterRead(a,i)}))},onAfterRead:function(t,e){var i=this;this.resetInput();var n=t;if(e){var a=t;Array.isArray(t)?(a=[],n=[],t.forEach((function(t){t.file&&(c(t.file,i.maxSize)?a.push(t):n.push(t))}))):n=null,this.$emit("oversize",a,this.getDetail())}var s=Array.isArray(n)?Boolean(n.length):Boolean(n);s&&(this.$emit("input",[].concat(this.fileList,o(n))),this.afterRead&&this.afterRead(n,this.getDetail()))},onDelete:function(t,e){var i,n=this,s=null!=(i=t.beforeDelete)?i:this.beforeDelete;if(s){var r=s(t,this.getDetail(e));if(!r)return;if((0,a.tI)(r))return void r.then((function(){n.deleteFile(t,e)})).catch(a.ZT)}this.deleteFile(t,e)},deleteFile:function(t,e){var i=this.fileList.slice(0);i.splice(e,1),this.$emit("input",i),this.$emit("delete",t,this.getDetail(e))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onClickUpload:function(t){this.$emit("click-upload",t)},onPreviewImage:function(t){var e=this;if(this.previewFullImage){var i=this.fileList.filter((function(t){return h(t)})),a=i.map((function(t){return t.file&&!t.url&&"failed"!==t.status&&(t.url=URL.createObjectURL(t.file),e.urls.push(t.url)),t.url}));this.imagePreview=(0,v.Z)((0,n.Z)({images:a,startPosition:i.indexOf(t),onClose:function(){e.$emit("close-preview")}},this.previewOptions))}},closeImagePreview:function(){this.imagePreview&&this.imagePreview.close()},chooseFile:function(){this.disabled||this.$refs.input&&this.$refs.input.click()},genPreviewMask:function(t){var e=this.$createElement,i=t.status,n=t.message;if("uploading"===i||"failed"===i){var s="failed"===i?e(p.Z,{attrs:{name:"close"},class:y("mask-icon")}):e(g.Z,{class:y("loading")}),r=(0,a.Xq)(n)&&""!==n;return e("div",{class:y("mask")},[s,r&&e("div",{class:y("mask-message")},[n])])}},genPreviewItem:function(t,e){var i,a,s,r=this,o=this.$createElement,l=null!=(i=t.deletable)?i:this.deletable,c="uploading"!==t.status&&l,u=c&&o("div",{class:y("preview-delete"),on:{click:function(i){i.stopPropagation(),r.onDelete(t,e)}}},[o(p.Z,{attrs:{name:"cross"},class:y("preview-delete-icon")})]),d=this.slots("preview-cover",(0,n.Z)({index:e},t)),f=d&&o("div",{class:y("preview-cover")},[d]),g=null!=(a=t.previewSize)?a:this.previewSize,v=null!=(s=t.imageFit)?s:this.imageFit,w=h(t)?o(m.Z,{attrs:{fit:v,src:t.content||t.url,width:g,height:g,lazyLoad:this.lazyLoad},class:y("preview-image"),on:{click:function(){r.onPreviewImage(t)}}},[f]):o("div",{class:y("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[o(p.Z,{class:y("file-icon"),attrs:{name:"description"}}),o("div",{class:[y("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),f]);return o("div",{class:y("preview"),on:{click:function(){r.$emit("click-preview",t,r.getDetail(e))}}},[w,this.genPreviewMask(t),u])},genPreviewList:function(){if(this.previewImage)return this.fileList.map(this.genPreviewItem)},genUpload:function(){var t=this.$createElement;if(!(this.fileList.length>=this.maxCount)){var e,i=this.slots(),a=this.readonly?null:t("input",{attrs:(0,n.Z)({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:y("input"),on:{change:this.onChange}});if(i)return t("div",{class:y("input-wrapper"),key:"input-wrapper",on:{click:this.onClickUpload}},[i,a]);if(this.previewSize){var s=this.previewSizeWithUnit;e={width:s,height:s}}return t("div",{directives:[{name:"show",value:this.showUpload}],class:y("upload",{readonly:this.readonly}),style:e,on:{click:this.onClickUpload}},[t(p.Z,{attrs:{name:this.uploadIcon},class:y("upload-icon")}),this.uploadText&&t("span",{class:y("upload-text")},[this.uploadText]),a])}}},render:function(){var t=arguments[0];return t("div",{class:y()},[t("div",{class:y("wrapper",{disabled:this.disabled})},[this.genPreviewList(),this.genUpload()])])}})},42511:function(t,e,i){i(22184),i(74048),i(14106),i(4127),i(96073),i(44174),i(43874),i(45353),i(86051),i(57462)},89158:function(t,e,i){i.d(e,{Ew:function(){return u},Ko:function(){return r},Mz:function(){return g},S:function(){return f},VU:function(){return d},aN:function(){return o},h2:function(){return l},lR:function(){return h},mh:function(){return a},nT:function(){return p},tr:function(){return s},w:function(){return m},yS:function(){return c}});var n=i(97344);const a=t=>(0,n.Z)({url:"api/sellerGoods!info.action",method:"post",params:t}),s=t=>(0,n.Z)({url:"/api/evaluation!list.action",method:"post",params:t}),r=t=>(0,n.Z)({url:"api/seller!info.action",method:"post",params:t}),o=t=>(0,n.Z)({url:"api/order!submit.action",method:"post",params:t}),l=t=>(0,n.Z)({url:"api/order!pay.action",method:"post",params:t}),c=t=>(0,n.Z)({url:"api/order!info.action",method:"post",params:t}),u=t=>(0,n.Z)({url:"/seller/version!register.action",method:"post",params:t}),d=t=>(0,n.Z)({url:"api/uploadimg!execute.action",method:"post",data:t}),h=t=>(0,n.Z)({url:"api/kyc!get.action",method:"post",params:t}),f=t=>(0,n.Z)({url:"api/keepGoods!add.action",method:"post",params:t}),p=t=>(0,n.Z)({url:"api/keepGoods!del.action",method:"post",params:t}),m=t=>(0,n.Z)({url:"api/evaluation!countType.action",method:"post",params:t}),g=t=>(0,n.Z)({url:"api/sellerGoods!recommend_like.action",method:"post",params:t})}}]);