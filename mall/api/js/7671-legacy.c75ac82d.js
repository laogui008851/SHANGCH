"use strict";(self["webpackChunkshop"]=self["webpackChunkshop"]||[]).push([[7671],{48102:function(t,e,n){n.r(e),n.d(e,{default:function(){return y}});n(89730);var i,o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-content"},[e("van-nav-bar",{attrs:{"safe-area-inset-top":"",fixed:"",title:t.$t("评价"),"left-arrow":""},on:{"click-left":function(){return t.$router.back()}}}),e("div",{staticStyle:{width:"100%",height:"46px"}}),t.goodsData.length?e("div",{staticClass:"evaluate-content"},[t._l(t.goodsData,(function(n,i){var o;return e("div",{key:i,staticClass:"item"},[e("div",{staticClass:"goods-info"},[e("div",{staticClass:"poster"},[e("img",{attrs:{src:n.goodsIcon,alt:""}})]),e("div",{staticClass:"info"},[e("p",{staticClass:"name"},[t._v(t._s((null===(o=n.goodsName)||void 0===o?void 0:o.length)>27?n.goodsName.slice(0,27)+"...":n.goodsName))]),e("p",{staticClass:"price"},[t._v("$ "+t._s(t.priceFormat(n.goodsReal)))]),e("van-rate",{staticClass:"rate-wrap",attrs:{size:15,":color":t.mainColor,"void-icon":"star","void-color":"#D9D9D9"},model:{value:n.rating,callback:function(e){t.$set(n,"rating",e)},expression:"item.rating"}})],1)]),e("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:4},placeholder:t.$t("请输入评价信息"),resize:"none",maxlength:"1000","show-word-limit":""},model:{value:n.content,callback:function(e){t.$set(n,"content",e)},expression:"item.content"}}),e("div",{staticClass:"evaluate-title"},[t._v(t._s(t.$t("评价晒图")))]),e("van-uploader",{attrs:{"after-read":t.afterRead,name:i,"max-count":9,accept:".png,.jpg,.jpeg"},model:{value:n.fileList,callback:function(e){t.$set(n,"fileList",e)},expression:"item.fileList"}})],1)})),e("div",{staticClass:"submit-btn",on:{click:t.submitHandle}},[t._v(t._s(t.$t("提交评论")))])],2):t._e()],1)},r=[],a=n(50124),s=n(48534),c=n(82482),l=(n(42511),n(29538)),u=(n(19066),n(87740)),d=(n(37850),n(88848)),f=(n(83627),n(90797)),h=(n(34284),n(96869),n(60228),n(49693),n(47522),n(50886),n(69358),n(97195),n(14970)),p=n(10408),m=n(89158),g=n(15941),v={name:"OrderEvaluate",components:(i={},(0,c.Z)(i,f.Z.name,f.Z),(0,c.Z)(i,d.Z.name,d.Z),(0,c.Z)(i,u.Z.name,u.Z),(0,c.Z)(i,l.Z.name,l.Z),i),data:function(){return{mainColor:"#f89900",fileList:[],cancelShow:!1,remindShow:!1,currentData:null,orderId:null,goodsData:[]}},mounted:function(){var t=this;this.$nextTick((function(){var e=t.$route.query.id;e?(t.orderId=e,t.getOrderGoods()):((0,d.Z)(t.$t("订单号不存在")),setTimeout((function(){t.$router.back()}),1500))}))},methods:{afterRead:function(t,e){var n=this,i=e.name,o=this.goodsData[i].fileList.length;d.Z.loading({duration:0,message:this.$t("上传中"),forbidClick:!0});var r=new FormData;r.append("file",t.file),r.append("moduleName","selle");(0,m.VU)(r).then((function(t){g.log("图片上传成功",t),n.goodsData[i]["imgUrl".concat(o)]=t}))["catch"]((function(t){n.fileList=[],n.$notify(n.$t("上传失败"))}))["finally"]((function(){d.Z.clear()}))},priceFormat:function(t){return(0,p.XY)(t)},getOrderGoods:function(){var t=this;d.Z.loading({duration:0,message:this.$t("请求中"),forbidClick:!0}),(0,h.K7)({orderId:this.orderId}).then((function(e){var n=e.pageList||[];n.forEach((function(t){t.rating=5,t.content=""})),t.goodsData=n,d.Z.clear()}))["catch"]((function(){d.Z.clear()}))},submitHandle:function(){var t=this;return(0,s.Z)((0,a.Z)().mark((function e(){var n,i;return(0,a.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.goodsData.map((function(e){var n=e.rating,i=e.content,o=e.goodsId,r="1";r=n<2?"3":n<4?"2":"1";var a={orderId:t.orderId,sellerGoodsId:o,rating:n,content:i,evaluationType:r};return Object.keys(e).forEach((function(t){-1!==t.indexOf("imgUrl")&&(a[t]=e[t])})),a})),d.Z.loading({duration:0,message:t.$t("提交中"),forbidClick:!0}),i=0;case 3:if(!(i<n.length)){e.next=9;break}return e.next=6,(0,h.MR)(n[i]);case 6:i++,e.next=3;break;case 9:d.Z.success(t.$t("成功")),setTimeout((function(){t.$router.back()}),1e3);case 11:case"end":return e.stop()}}),e)})))()}}},b=v,Z=n(1001),k=(0,Z.Z)(b,o,r,!1,null,"b97da806",null),y=k.exports},87740:function(t,e,n){n(79288),n(50886),n(49693),n(60228),n(47522);var i=n(32667),o=n(80408),r=n(85781),a=n(93969),s=n(35065),c=n(19858),l=(0,i.d)("rate"),u=l[0],d=l[1];function f(t,e,n){return t>=e?"full":t+.5>=e&&n?"half":"void"}e["Z"]=u({mixins:[a.D,s.f],props:{size:[Number,String],color:String,gutter:[Number,String],readonly:Boolean,disabled:Boolean,allowHalf:Boolean,voidColor:String,iconPrefix:String,disabledColor:String,value:{type:Number,default:0},icon:{type:String,default:"star"},voidIcon:{type:String,default:"star-o"},count:{type:[Number,String],default:5},touchable:{type:Boolean,default:!0}},computed:{list:function(){for(var t=[],e=1;e<=this.count;e++)t.push(f(this.value,e,this.allowHalf));return t},sizeWithUnit:function(){return(0,o.N)(this.size)},gutterWithUnit:function(){return(0,o.N)(this.gutter)}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{select:function(t){this.disabled||this.readonly||t===this.value||(this.$emit("input",t),this.$emit("change",t))},onTouchStart:function(t){var e=this;if(!this.readonly&&!this.disabled&&this.touchable){this.touchStart(t);var n=this.$refs.items.map((function(t){return t.getBoundingClientRect()})),i=[];n.forEach((function(t,n){e.allowHalf?i.push({score:n+.5,left:t.left},{score:n+1,left:t.left+t.width/2}):i.push({score:n+1,left:t.left})})),this.ranges=i}},onTouchMove:function(t){if(!this.readonly&&!this.disabled&&this.touchable&&(this.touchMove(t),"horizontal"===this.direction)){(0,r.PF)(t);var e=t.touches[0].clientX;this.select(this.getScoreByPosition(e))}},getScoreByPosition:function(t){for(var e=this.ranges.length-1;e>0;e--)if(t>this.ranges[e].left)return this.ranges[e].score;return this.allowHalf?.5:1},genStar:function(t,e){var n,i=this,o=this.$createElement,r=this.icon,a=this.color,s=this.count,l=this.voidIcon,u=this.disabled,f=this.voidColor,h=this.disabledColor,p=e+1,m="full"===t,g="void"===t;return this.gutterWithUnit&&p!==+s&&(n={paddingRight:this.gutterWithUnit}),o("div",{ref:"items",refInFor:!0,key:e,attrs:{role:"radio",tabindex:"0","aria-setsize":s,"aria-posinset":p,"aria-checked":String(!g)},style:n,class:d("item")},[o(c.Z,{attrs:{size:this.sizeWithUnit,name:m?r:l,color:u?h:m?a:f,classPrefix:this.iconPrefix,"data-score":p},class:d("icon",{disabled:u,full:m}),on:{click:function(){i.select(p)}}}),this.allowHalf&&o(c.Z,{attrs:{size:this.sizeWithUnit,name:g?l:r,color:u?h:g?f:a,classPrefix:this.iconPrefix,"data-score":p-.5},class:d("icon",["half",{disabled:u,full:!g}]),on:{click:function(){i.select(p-.5)}}})])}},render:function(){var t=this,e=arguments[0];return e("div",{class:d({readonly:this.readonly,disabled:this.disabled}),attrs:{tabindex:"0",role:"radiogroup"}},[this.list.map((function(e,n){return t.genStar(e,n)}))])}})},19066:function(t,e,n){n(22184),n(14106),n(4127)},89158:function(t,e,n){n.d(e,{Ew:function(){return u},Ko:function(){return a},Mz:function(){return g},S:function(){return h},VU:function(){return d},aN:function(){return s},h2:function(){return c},lR:function(){return f},mh:function(){return o},nT:function(){return p},tr:function(){return r},w:function(){return m},yS:function(){return l}});var i=n(97344),o=function(t){return(0,i.Z)({url:"api/sellerGoods!info.action",method:"post",params:t})},r=function(t){return(0,i.Z)({url:"/api/evaluation!list.action",method:"post",params:t})},a=function(t){return(0,i.Z)({url:"api/seller!info.action",method:"post",params:t})},s=function(t){return(0,i.Z)({url:"api/order!submit.action",method:"post",params:t})},c=function(t){return(0,i.Z)({url:"api/order!pay.action",method:"post",params:t})},l=function(t){return(0,i.Z)({url:"api/order!info.action",method:"post",params:t})},u=function(t){return(0,i.Z)({url:"/seller/version!register.action",method:"post",params:t})},d=function(t){return(0,i.Z)({url:"api/uploadimg!execute.action",method:"post",data:t})},f=function(t){return(0,i.Z)({url:"api/kyc!get.action",method:"post",params:t})},h=function(t){return(0,i.Z)({url:"api/keepGoods!add.action",method:"post",params:t})},p=function(t){return(0,i.Z)({url:"api/keepGoods!del.action",method:"post",params:t})},m=function(t){return(0,i.Z)({url:"api/evaluation!countType.action",method:"post",params:t})},g=function(t){return(0,i.Z)({url:"api/sellerGoods!recommend_like.action",method:"post",params:t})}}}]);