"use strict";(self["webpackChunkshop"]=self["webpackChunkshop"]||[]).push([[110],{74921:function(t,e,i){i.r(e),i.d(e,{default:function(){return Z}});i(89730);var n,a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-content"},[e("van-nav-bar",{attrs:{"safe-area-inset-top":"",fixed:"",title:t.$t("评价"),"left-arrow":""},on:{"click-left":function(){return t.$router.back()}}}),e("div",{staticStyle:{width:"100%",height:"46px"}}),t.goodsData.length?e("div",{staticClass:"evaluate-content"},[t._l(t.goodsData,(function(i,n){var a;return e("div",{key:n,staticClass:"item"},[e("div",{staticClass:"goods-info"},[e("div",{staticClass:"poster"},[e("img",{attrs:{src:i.goodsIcon,alt:""}})]),e("div",{staticClass:"info"},[e("p",{staticClass:"name"},[t._v(t._s((null===(a=i.goodsName)||void 0===a?void 0:a.length)>27?i.goodsName.slice(0,27)+"...":i.goodsName))]),e("p",{staticClass:"price"},[t._v("$ "+t._s(t.priceFormat(i.goodsReal)))]),e("van-rate",{staticClass:"rate-wrap",attrs:{size:15,":color":t.mainColor,"void-icon":"star","void-color":"#D9D9D9"},model:{value:i.rating,callback:function(e){t.$set(i,"rating",e)},expression:"item.rating"}})],1)]),e("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:4},placeholder:t.$t("请输入评价信息"),resize:"none",maxlength:"1000","show-word-limit":""},model:{value:i.content,callback:function(e){t.$set(i,"content",e)},expression:"item.content"}}),e("div",{staticClass:"evaluate-title"},[t._v(t._s(t.$t("评价晒图")))]),e("van-uploader",{attrs:{"after-read":t.afterRead,name:n,"max-count":9,accept:".png,.jpg,.jpeg"},model:{value:i.fileList,callback:function(e){t.$set(i,"fileList",e)},expression:"item.fileList"}})],1)})),e("div",{staticClass:"submit-btn",on:{click:t.submitHandle}},[t._v(t._s(t.$t("提交评论")))])],2):t._e()],1)},r=[],s=i(51907),o=i(85617),l=i(54503),u=(i(12144),i(39907)),c=(i(19597),i(94530)),d=(i(55601),i(10521)),f=(i(90191),i(29723)),h=(i(34284),i(96869),i(60228),i(49693),i(47522),i(50886),i(69358),i(97195),i(9426)),p=i(49425),m=i(58030),v=i(81273),g={name:"OrderEvaluate",components:(n={},(0,l.Z)(n,f.Z.name,f.Z),(0,l.Z)(n,d.Z.name,d.Z),(0,l.Z)(n,c.Z.name,c.Z),(0,l.Z)(n,u.Z.name,u.Z),n),data:function(){return{mainColor:"#f89900",fileList:[],cancelShow:!1,remindShow:!1,currentData:null,orderId:null,goodsData:[]}},mounted:function(){var t=this;this.$nextTick((function(){var e=t.$route.query.id;e?(t.orderId=e,t.getOrderGoods()):((0,d.Z)(t.$t("订单号不存在")),setTimeout((function(){t.$router.back()}),1500))}))},methods:{afterRead:function(t,e){var i=this,n=e.name,a=this.goodsData[n].fileList.length;d.Z.loading({duration:0,message:this.$t("上传中"),forbidClick:!0});var r=new FormData;r.append("file",t.file),r.append("moduleName","selle");(0,m.VU)(r).then((function(t){v.log("图片上传成功",t),i.goodsData[n]["imgUrl".concat(a)]=t}))["catch"]((function(t){i.fileList=[],i.$notify(i.$t("上传失败"))}))["finally"]((function(){d.Z.clear()}))},priceFormat:function(t){return(0,p.XY)(t)},getOrderGoods:function(){var t=this;d.Z.loading({duration:0,message:this.$t("请求中"),forbidClick:!0}),(0,h.K7)({orderId:this.orderId}).then((function(e){var i=e.pageList||[];i.forEach((function(t){t.rating=5,t.content=""})),t.goodsData=i,d.Z.clear()}))["catch"]((function(){d.Z.clear()}))},submitHandle:function(){var t=this;return(0,o.Z)((0,s.Z)().mark((function e(){var i,n;return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=t.goodsData.map((function(e){var i=e.rating,n=e.content,a=e.goodsId,r="1";r=i<2?"3":i<4?"2":"1";var s={orderId:t.orderId,sellerGoodsId:a,rating:i,content:n,evaluationType:r};return Object.keys(e).forEach((function(t){-1!==t.indexOf("imgUrl")&&(s[t]=e[t])})),s})),d.Z.loading({duration:0,message:t.$t("提交中"),forbidClick:!0}),n=0;case 3:if(!(n<i.length)){e.next=9;break}return e.next=6,(0,h.MR)(i[n]);case 6:n++,e.next=3;break;case 9:d.Z.success(t.$t("成功")),setTimeout((function(){t.$router.back()}),1e3);case 11:case"end":return e.stop()}}),e)})))()}}},w=g,b=i(1001),y=(0,b.Z)(w,a,r,!1,null,"b97da806",null),Z=y.exports},14683:function(t,e,i){i.d(e,{f:function(){return n}});var n={inject:{vanField:{default:null}},watch:{value:function(){var t=this.vanField;t&&(t.resetValidation(),t.validateWithTrigger("onChange"))}},created:function(){var t=this.vanField;t&&!t.children&&(t.children=this)}}},94530:function(t,e,i){i(79288),i(50886),i(49693),i(60228),i(47522);var n=i(92072),a=i(45291),r=i(86472),s=i(69579),o=i(14683),l=i(28490),u=(0,n.d)("rate"),c=u[0],d=u[1];function f(t,e,i){return t>=e?"full":t+.5>=e&&i?"half":"void"}e["Z"]=c({mixins:[s.D,o.f],props:{size:[Number,String],color:String,gutter:[Number,String],readonly:Boolean,disabled:Boolean,allowHalf:Boolean,voidColor:String,iconPrefix:String,disabledColor:String,value:{type:Number,default:0},icon:{type:String,default:"star"},voidIcon:{type:String,default:"star-o"},count:{type:[Number,String],default:5},touchable:{type:Boolean,default:!0}},computed:{list:function(){for(var t=[],e=1;e<=this.count;e++)t.push(f(this.value,e,this.allowHalf));return t},sizeWithUnit:function(){return(0,a.N)(this.size)},gutterWithUnit:function(){return(0,a.N)(this.gutter)}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{select:function(t){this.disabled||this.readonly||t===this.value||(this.$emit("input",t),this.$emit("change",t))},onTouchStart:function(t){var e=this;if(!this.readonly&&!this.disabled&&this.touchable){this.touchStart(t);var i=this.$refs.items.map((function(t){return t.getBoundingClientRect()})),n=[];i.forEach((function(t,i){e.allowHalf?n.push({score:i+.5,left:t.left},{score:i+1,left:t.left+t.width/2}):n.push({score:i+1,left:t.left})})),this.ranges=n}},onTouchMove:function(t){if(!this.readonly&&!this.disabled&&this.touchable&&(this.touchMove(t),"horizontal"===this.direction)){(0,r.PF)(t);var e=t.touches[0].clientX;this.select(this.getScoreByPosition(e))}},getScoreByPosition:function(t){for(var e=this.ranges.length-1;e>0;e--)if(t>this.ranges[e].left)return this.ranges[e].score;return this.allowHalf?.5:1},genStar:function(t,e){var i,n=this,a=this.$createElement,r=this.icon,s=this.color,o=this.count,u=this.voidIcon,c=this.disabled,f=this.voidColor,h=this.disabledColor,p=e+1,m="full"===t,v="void"===t;return this.gutterWithUnit&&p!==+o&&(i={paddingRight:this.gutterWithUnit}),a("div",{ref:"items",refInFor:!0,key:e,attrs:{role:"radio",tabindex:"0","aria-setsize":o,"aria-posinset":p,"aria-checked":String(!v)},style:i,class:d("item")},[a(l.Z,{attrs:{size:this.sizeWithUnit,name:m?r:u,color:c?h:m?s:f,classPrefix:this.iconPrefix,"data-score":p},class:d("icon",{disabled:c,full:m}),on:{click:function(){n.select(p)}}}),this.allowHalf&&a(l.Z,{attrs:{size:this.sizeWithUnit,name:v?u:r,color:c?h:v?f:s,classPrefix:this.iconPrefix,"data-score":p-.5},class:d("icon",["half",{disabled:c,full:!v}]),on:{click:function(){n.select(p-.5)}}})])}},render:function(){var t=this,e=arguments[0];return e("div",{class:d({readonly:this.readonly,disabled:this.disabled}),attrs:{tabindex:"0",role:"radiogroup"}},[this.list.map((function(e,i){return t.genStar(e,i)}))])}})},19597:function(t,e,i){i(22184),i(14106),i(4127)},39907:function(t,e,i){i.d(e,{Z:function(){return Z}});i(79288),i(49693),i(60228),i(47522),i(21694),i(76265),i(78730),i(79307),i(34284),i(89730),i(63975),i(50886),i(34338),i(62506),i(38077),i(97195);var n=i(27378),a=i(40868),r=i(92072),s=i(45291);i(98742),i(64043),i(7409);function o(t){return Array.isArray(t)?t:[t]}function l(t,e){return new Promise((function(i){if("file"!==e){var n=new FileReader;n.onload=function(t){i(t.target.result)},"dataUrl"===e?n.readAsDataURL(t):"text"===e&&n.readAsText(t)}else i(null)}))}function u(t,e){return o(t).some((function(t){return!!t&&((0,a.mf)(e)?e(t):t.size>e)}))}var c=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function d(t){return c.test(t)}function f(t){return!!t.isImage||(t.file&&t.file.type?0===t.file.type.indexOf("image"):t.url?d(t.url):!!t.content&&0===t.content.indexOf("data:image"))}var h=i(14683),p=i(28490),m=i(67094),v=i(98372),g=i(24926),w=(0,r.d)("uploader"),b=w[0],y=w[1],Z=b({inheritAttrs:!1,mixins:[h.f],model:{prop:"fileList"},props:{disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],previewOptions:Object,name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:[Number,String,Function],default:Number.MAX_VALUE},maxCount:{type:[Number,String],default:Number.MAX_VALUE},deletable:{type:Boolean,default:!0},showUpload:{type:Boolean,default:!0},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"},uploadIcon:{type:String,default:"photograph"}},computed:{previewSizeWithUnit:function(){return(0,s.N)(this.previewSize)},value:function(){return this.fileList}},created:function(){this.urls=[]},beforeDestroy:function(){this.urls.forEach((function(t){return URL.revokeObjectURL(t)}))},methods:{getDetail:function(t){return void 0===t&&(t=this.fileList.length),{name:this.name,index:t}},onChange:function(t){var e=this,i=t.target.files;if(!this.disabled&&i.length){if(i=1===i.length?i[0]:[].slice.call(i),this.beforeRead){var n=this.beforeRead(i,this.getDetail());if(!n)return void this.resetInput();if((0,a.tI)(n))return void n.then((function(t){t?e.readFile(t):e.readFile(i)}))["catch"](this.resetInput)}this.readFile(i)}},readFile:function(t){var e=this,i=u(t,this.maxSize);if(Array.isArray(t)){var n=this.maxCount-this.fileList.length;t.length>n&&(t=t.slice(0,n)),Promise.all(t.map((function(t){return l(t,e.resultType)}))).then((function(n){var a=t.map((function(t,e){var i={file:t,status:"",message:""};return n[e]&&(i.content=n[e]),i}));e.onAfterRead(a,i)}))}else l(t,this.resultType).then((function(n){var a={file:t,status:"",message:""};n&&(a.content=n),e.onAfterRead(a,i)}))},onAfterRead:function(t,e){var i=this;this.resetInput();var n=t;if(e){var a=t;Array.isArray(t)?(a=[],n=[],t.forEach((function(t){t.file&&(u(t.file,i.maxSize)?a.push(t):n.push(t))}))):n=null,this.$emit("oversize",a,this.getDetail())}var r=Array.isArray(n)?Boolean(n.length):Boolean(n);r&&(this.$emit("input",[].concat(this.fileList,o(n))),this.afterRead&&this.afterRead(n,this.getDetail()))},onDelete:function(t,e){var i,n=this,r=null!=(i=t.beforeDelete)?i:this.beforeDelete;if(r){var s=r(t,this.getDetail(e));if(!s)return;if((0,a.tI)(s))return void s.then((function(){n.deleteFile(t,e)}))["catch"](a.ZT)}this.deleteFile(t,e)},deleteFile:function(t,e){var i=this.fileList.slice(0);i.splice(e,1),this.$emit("input",i),this.$emit("delete",t,this.getDetail(e))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onClickUpload:function(t){this.$emit("click-upload",t)},onPreviewImage:function(t){var e=this;if(this.previewFullImage){var i=this.fileList.filter((function(t){return f(t)})),a=i.map((function(t){return t.file&&!t.url&&"failed"!==t.status&&(t.url=URL.createObjectURL(t.file),e.urls.push(t.url)),t.url}));this.imagePreview=(0,g.Z)((0,n.Z)({images:a,startPosition:i.indexOf(t),onClose:function(){e.$emit("close-preview")}},this.previewOptions))}},closeImagePreview:function(){this.imagePreview&&this.imagePreview.close()},chooseFile:function(){this.disabled||this.$refs.input&&this.$refs.input.click()},genPreviewMask:function(t){var e=this.$createElement,i=t.status,n=t.message;if("uploading"===i||"failed"===i){var r="failed"===i?e(p.Z,{attrs:{name:"close"},class:y("mask-icon")}):e(v.Z,{class:y("loading")}),s=(0,a.Xq)(n)&&""!==n;return e("div",{class:y("mask")},[r,s&&e("div",{class:y("mask-message")},[n])])}},genPreviewItem:function(t,e){var i,a,r,s=this,o=this.$createElement,l=null!=(i=t.deletable)?i:this.deletable,u="uploading"!==t.status&&l,c=u&&o("div",{class:y("preview-delete"),on:{click:function(i){i.stopPropagation(),s.onDelete(t,e)}}},[o(p.Z,{attrs:{name:"cross"},class:y("preview-delete-icon")})]),d=this.slots("preview-cover",(0,n.Z)({index:e},t)),h=d&&o("div",{class:y("preview-cover")},[d]),v=null!=(a=t.previewSize)?a:this.previewSize,g=null!=(r=t.imageFit)?r:this.imageFit,w=f(t)?o(m.Z,{attrs:{fit:g,src:t.content||t.url,width:v,height:v,lazyLoad:this.lazyLoad},class:y("preview-image"),on:{click:function(){s.onPreviewImage(t)}}},[h]):o("div",{class:y("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[o(p.Z,{class:y("file-icon"),attrs:{name:"description"}}),o("div",{class:[y("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),h]);return o("div",{class:y("preview"),on:{click:function(){s.$emit("click-preview",t,s.getDetail(e))}}},[w,this.genPreviewMask(t),c])},genPreviewList:function(){if(this.previewImage)return this.fileList.map(this.genPreviewItem)},genUpload:function(){var t=this.$createElement;if(!(this.fileList.length>=this.maxCount)){var e,i=this.slots(),a=this.readonly?null:t("input",{attrs:(0,n.Z)({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:y("input"),on:{change:this.onChange}});if(i)return t("div",{class:y("input-wrapper"),key:"input-wrapper",on:{click:this.onClickUpload}},[i,a]);if(this.previewSize){var r=this.previewSizeWithUnit;e={width:r,height:r}}return t("div",{directives:[{name:"show",value:this.showUpload}],class:y("upload",{readonly:this.readonly}),style:e,on:{click:this.onClickUpload}},[t(p.Z,{attrs:{name:this.uploadIcon},class:y("upload-icon")}),this.uploadText&&t("span",{class:y("upload-text")},[this.uploadText]),a])}}},render:function(){var t=arguments[0];return t("div",{class:y()},[t("div",{class:y("wrapper",{disabled:this.disabled})},[this.genPreviewList(),this.genUpload()])])}})},12144:function(t,e,i){i(22184),i(74048),i(14106),i(4127),i(96073),i(44174),i(43874),i(45353),i(86051),i(57462)},58030:function(t,e,i){i.d(e,{Ew:function(){return c},Ko:function(){return s},Mz:function(){return v},S:function(){return h},VU:function(){return d},aN:function(){return o},h2:function(){return l},lR:function(){return f},mh:function(){return a},nT:function(){return p},tr:function(){return r},w:function(){return m},yS:function(){return u}});var n=i(36005),a=function(t){return(0,n.Z)({url:"api/sellerGoods!info.action",method:"post",params:t})},r=function(t){return(0,n.Z)({url:"/api/evaluation!list.action",method:"post",params:t})},s=function(t){return(0,n.Z)({url:"api/seller!info.action",method:"post",params:t})},o=function(t){return(0,n.Z)({url:"api/order!submit.action",method:"post",params:t})},l=function(t){return(0,n.Z)({url:"api/order!pay.action",method:"post",params:t})},u=function(t){return(0,n.Z)({url:"api/order!info.action",method:"post",params:t})},c=function(t){return(0,n.Z)({url:"/seller/version!register.action",method:"post",params:t})},d=function(t){return(0,n.Z)({url:"api/uploadimg!execute.action",method:"post",data:t})},f=function(t){return(0,n.Z)({url:"api/kyc!get.action",method:"post",params:t})},h=function(t){return(0,n.Z)({url:"api/keepGoods!add.action",method:"post",params:t})},p=function(t){return(0,n.Z)({url:"api/keepGoods!del.action",method:"post",params:t})},m=function(t){return(0,n.Z)({url:"api/evaluation!countType.action",method:"post",params:t})},v=function(t){return(0,n.Z)({url:"api/sellerGoods!recommend_like.action",method:"post",params:t})}}}]);